<!--Dashboard Script-->

<script>
  var serverData={};
  var teamMemberData = '';
  globalTotalDiscountAmt=0;
   var j=0;
  var ClientInvoiceDiscount ="";
  var Index=-1;
  var discountname ="";
  var moneyformate,currencyFormat;
  var format = "{% raw %}{{amount_with_comma_separator}}{% endraw %}";
  var shopname = "{{shop.name}}";
  var GsalesRepUrl = '';
  var Ghmac = '';
  var GorderId = '';
  var GShopName = '';
//calculate fixed wholesale discount
function CalculateFixedAmountDiscount(totalprice,price,discount,qty)
{
	return totalprice-((discount).toFixed(2)*qty);
}
  
function CalculateFixedAmountDiscountForPerProduct(totalprice,price,discount,qty)
{
	return totalprice-((discount).toFixed(2));
}  
 
//Calculate discount   
function CalculateDiscount(totalprice,price,discount,qty)
{
	return totalprice-((price*discount).toFixed(2)*qty);
}  

//Calculate Commission
function CalculateCommission(price,percentage)  
{
    return price*percentage;
}

function CalculateFixedAmountCommission(price,percentage)  
{
    return percentage*100*ProductQuantity;
}  
    
 //Get Product Price
 function getproductprice(productprice)
  {
    if(moneyformate == format)
		{
			var item_price = productprice.replace(".","");
			return Product_Price = item_price.replace(",",".");
      
	    }
	  else{
    
		  return Product_Price = productprice.replace(",","");
	  }
   }
         
//Get Wholesale Discount       
function getWholesaleDiscount(productArr,discountAr,currencyFormat,wholesaleqtydiscount,CommissionDiscountOn,CommissionDiscountType)
{	
 var totalDiscount=0;   
 var Product_Price,Item_price;
 for(singleproduct in productArr)
 {
    var quantity=0;
    var Amount=0;
     Product_Price = (productArr[singleproduct].product_price);
      Item_price = (productArr[singleproduct].Item_Price); 
   var getProductId = productArr[singleproduct].variantId;
   var getProductType = productArr[singleproduct].product_type;
   		
   	var flag = 0;
    var product_quantity = (productArr[singleproduct].product_quantity); 
   if(serverData.IsNewAdminUI && serverData.select.wholesaleqtydiscount)
   {
     {% if shop.metafields.SalesTeamQtyDiscount %}
       var QuantityBasedDiscountPerProductObj = {};

       {%for salesTeamInfo in shop.metafields.SalesTeamQtyDiscount %}
         {% assign QuantityBasedDiscountPerProductTable = salesTeamInfo | last %}
         {% for product in QuantityBasedDiscountPerProductTable %}
         	if(getProductId == {{ product.VariantId }})
            {
            	QuantityBasedDiscountPerProductObj[{{ product.quantity }}] = {{ product.DiscountAmt }}; 
            }
          {% endfor %}
       {% endfor %}

       var sortable = [];
       for (var obj in QuantityBasedDiscountPerProductObj) {
         sortable.push([obj, QuantityBasedDiscountPerProductObj[obj]]);
       }

       for(var i=sortable.length-1; i >= 0 && flag == 0; i--)
       {
         if(parseInt(product_quantity) >= parseInt(sortable[i][0]))
         {
           DiscountAmount = ((parseFloat(Product_Price) -  parseFloat(Product_Price) * parseFloat(sortable[i][1]))).toFixed(2);
           wholesaleProduct[singleproduct]["Discounted_Amount"] = DiscountAmount.toString();
           flag = 1;
         }
       }
     {% endif %}
       
   	}
   
    
    if(serverData.IsNewAdminUI && serverData.select.wholesaleqtydiscount)
    {
      if( flag == 0 )
      {
        wholesaleProduct[singleproduct]["Discounted_Amount"] = "No Discount";
         totalDiscount = parseFloat(totalDiscount) + parseFloat(Product_Price);
      }
      else{
        totalDiscount = parseFloat(totalDiscount) + parseFloat(wholesaleProduct[singleproduct]["Discounted_Amount"]);
      }
      
      globalTotalDiscountAmt=parseFloat(totalDiscount);
	  finalDiscount=parseFloat(totalDiscount);
    }
   else{
      if(CommissionDiscountOn == "Product")
      {
        for(var discount in discountAr)
        {
          var responseProductId = discountAr[discount].variantId;
          if(getProductId == responseProductId)
          {
                if(CommissionDiscountType == "FixedDollarAmount")
                {				 
                   var discountAmount = CalculateFixedAmountDiscount(parseFloat(Product_Price),parseFloat(Item_price), parseFloat(discountAr[discount].DiscountAmt)*100,parseFloat(productArr[singleproduct].product_quantity));
                   totalDiscount=totalDiscount+discountAmount;
                }
                else
                {
                  var discountAmount = CalculateDiscount(parseFloat(Product_Price),parseFloat(Item_price), parseFloat(discountAr[discount].DiscountAmt),parseFloat(productArr[singleproduct].product_quantity));
                  totalDiscount=totalDiscount+discountAmount;
                }
               
                discountAmount = discountAmount.toFixed(2);
                if(moneyformate == format)
                {
                   discountAmount = discountAmount.replace(".",",");
                }
            
                //if discounted amount and actual price are same then show "No Discount" else show discounted price
                if(discountAr[discount].DiscountAmt == 0)
                {
                   productArr[singleproduct]["Discounted_Amount"] = "No Discount";  
                }
                else
                {
                  productArr[singleproduct]["Discounted_Amount"] = discountAmount.toString();
                } 
          }
        }        
      }
        
      if(CommissionDiscountOn == "ProductType")
      {
         getProductType = productArr[singleproduct].product_type;
        //if product type is not set 
        if(getProductType == "")
        {
          	getProductType = "All Other Products";            
        }
        for(var discount in discountAr)
    	{ 
          var responseProductType = discountAr[discount].type;
          if(getProductType.toLowerCase() == responseProductType.toLowerCase())
          {
               if(discountAr[discount].DiscountAmt == 0)
               {
                 discountAmount = parseFloat(Product_Price);
               }
               else
               {
                 var discountAmount = CalculateDiscount(parseFloat(Product_Price),parseFloat(Item_price), parseFloat(discountAr[discount].DiscountAmt),parseFloat(productArr[singleproduct].product_quantity));
               }
               totalDiscount = parseFloat(totalDiscount) + parseFloat(discountAmount);
               discountAmount = discountAmount.toFixed(2);
               if(moneyformate == format)
               {
                 discountAmount = discountAmount.replace(".",",");
               }
               
                //if discounted amount and actual price are same then show "No Discount" else show discounted price
                if(discountAr[discount].DiscountAmt == 0)
                {
                   wholesaleProduct[singleproduct]["Discounted_Amount"] = "No Discount";  
                }
                else
                {
                  wholesaleProduct[singleproduct]["Discounted_Amount"] = discountAmount.toString();
                }     
    	  }
        }
      }  
   
      if(CommissionDiscountOn == "SalesRep")
        {
          var getSalesRepId = "{{customer.id}}";
            var responseSalesRepId = discountAr.SalesRepId;
            if(getSalesRepId == responseSalesRepId)
            {             
               var discountAmount = CalculateDiscount(parseFloat(Product_Price),parseFloat(Item_price), parseFloat(discountAr.WholesaleDiscount),parseFloat(productArr[singleproduct].product_quantity));
              totalDiscount = parseFloat(totalDiscount) + parseFloat(discountAmount);
              discountAmount = discountAmount.toFixed(2);
              if(moneyformate == format)
              {
                 discountAmount = discountAmount.replace(".",",");
              }
                //if discounted amount and actual price are same then show "No Discount" else show discounted price
               if(discountAr.WholesaleDiscount == 0)
              {
                 wholesaleProduct[singleproduct]["Discounted_Amount"] = "No Discount";  
              }
              else
              {
                wholesaleProduct[singleproduct]["Discounted_Amount"] = discountAmount.toString();
              } 
            }                  
        } 
     
     	globalTotalDiscountAmt=parseFloat(totalDiscount);
       	finalDiscount=subtotal-parseFloat(globalTotalDiscountAmt);
   }

       
         $('#totalPrice').html('Total Price: '+"<b>"+currencyFormat+"</b>"+" "+"<b>"+ subtotal.toFixed(2)+"</b>");

        if(serverData.IsNewAdminUI && serverData.select.wholesaleqtydiscount){
           $('#DiscountedPrice').html(' Your Discounted Price: '+"<b>"+(finalDiscount == 0 ? "No discount" : currencyFormat +" "+finalDiscount.toFixed(2))+"</b>"); 
       }
       else{
          $('#DiscountedPrice').html(' Your Discounted Price: '+"<b>"+currencyFormat+"</b>"+" "+"<b>"+(subtotal- finalDiscount).toFixed(2)+"</b>"); 
      }
  }
}
  
//Get quantity based Wholesale Discount       
function getQuantityBasedWholesaleDiscount(productArr,discountAr,currencyFormat,wholesaleqtydiscount,CommissionDiscountOn,CommissionDiscountType,discountArray)
{	
 var totalDiscount=0;   
 var Product_Price,Item_price;
 for(singleproduct in productArr)
 {
    var quantity=0;
    var Amount=0;
     Product_Price = (productArr[singleproduct].product_price);
      Item_price = (productArr[singleproduct].Item_Price); 
   var getProductId = productArr[singleproduct].variantId;
   var getProductType = productArr[singleproduct].product_type;
   if(CommissionDiscountOn == "Product")
   {
         for(var discount in discountArray)
    	 {
    	   var responseVaraintId = discountArray[discount].VariantId;              
           if(getProductId == responseVaraintId &&  productArr[singleproduct].product_quantity >= discountArray[discount].quantity)
           {
             if(discountArray[discount].quantity>quantity)
             {
               if(productArr[singleproduct].product_quantity>quantity)
               {
                 quantity=discountArray[discount].quantity; 
                 Amount=(discountArray[discount].DiscountAmt);
               }
                
             }
           }
         }
        if(quantity>0)
        {
          CalculateDiscountedPrice(Amount);  
        }
        else
        {
          wholesaleProduct[singleproduct]["Discounted_Amount"] = "No Discount"; 
          totalDiscount=totalDiscount+parseFloat(Product_Price);
        }
   }
   else
   {
        if(getProductType == "")
        {
          	getProductType = "All Other Products";
            
        }
         for(var discount in discountAr)
    	 {
    	   var responseProductType = discountAr[discount].type;              
           if(getProductType.toLowerCase() == responseProductType.toLowerCase() &&  productArr[singleproduct].product_quantity >= discountAr[discount].quantity)
           {
             if(discountAr[discount].quantity>quantity)
             {
               if(productArr[singleproduct].product_quantity>quantity)
               {
                 quantity=discountAr[discount].quantity; 
                 Amount=(discountAr[discount].DiscountAmt);
               }
                
             }
           }
         }
        if(quantity>0)
        {
          CalculateDiscountedPrice(Amount);  
        }
        else
        {
          wholesaleProduct[singleproduct]["Discounted_Amount"] = "No Discount"; 
          totalDiscount=totalDiscount+parseFloat(Product_Price);
        }
   }

        function CalculateDiscountedPrice(Amount)
        {
          if(CommissionDiscountType == "FixedDollarAmount")
          {
	           var discountAmount = CalculateFixedAmountDiscountForPerProduct(parseFloat(Product_Price),parseFloat(Item_price), parseFloat(Amount)*100,parseFloat(productArr[singleproduct].product_quantity));
          totalDiscount=totalDiscount+discountAmount;
          }
          else{
            var discountAmount = CalculateDiscount(parseFloat(Product_Price),parseFloat(Item_price), parseFloat(Amount),parseFloat(productArr[singleproduct].product_quantity));
          totalDiscount=totalDiscount+discountAmount;
          }
            
          discountAmount = discountAmount.toFixed(2);
          if(moneyformate == format)
		  {
		     discountAmount = discountAmount.replace(".",",");
		  }
          wholesaleProduct[singleproduct]["Discounted_Amount"] = discountAmount.toString();
        }
                          

       globalTotalDiscountAmt=parseFloat(totalDiscount);
       finalDiscount=subtotal-parseFloat(globalTotalDiscountAmt);
  
       $('#totalPrice').html('Total Price: '+"<b>"+currencyFormat+"</b>"+" "+"<b>"+ subtotal.toFixed(2)+"</b>");
       if(finalDiscount==0){
           $('#DiscountedPrice').html(' Your Discounted Price:: '+"<b>"+currencyFormat+"</b>"+" "+"<b>"+(totalDiscount).toFixed(2)+"</b>"); 
       }
       else{
          $('#DiscountedPrice').html(' Your Discounted Price: '+"<b>"+currencyFormat+"</b>"+" "+"<b>"+(subtotal- finalDiscount).toFixed(2)+"</b>"); 
      } 
  }
}  
 
//Get Customer Discount and Salesrep Commission
function getClientCommissionandDiscount(productArr,commissionAr,currencyFormat,CommissionDiscountOn,CommissionDiscountType)
{
 var Product_Price,Item_price,product_quantity;
  if(CommissionDiscountOn == "Product")
  {
	for(singleproduct in productArr)
	{
       var getProductId = productArr[singleproduct].variantId;
      Product_Price = (productArr[singleproduct].product_price);
      Item_price = (productArr[singleproduct].Item_Price);
      product_quantity = (productArr[singleproduct].product_quantity); 

      var flag = 0;
      
      if(serverData.select.QuantityBasedDiscountInInvoices)
      {
        {% if shop.metafields.SalesTeamQtyDiscount %}
          var QuantityBasedDiscountPerProductObj = {};

          {%for salesTeamInfo in shop.metafields.SalesTeamQtyDiscount %}
            {% assign QuantityBasedDiscountPerProductTable = salesTeamInfo | last %}
            {% for product in QuantityBasedDiscountPerProductTable %}
              if(getProductId == {{ product.VariantId }})
              {
                  QuantityBasedDiscountPerProductObj[{{ product.quantity }}] = {{ product.DiscountAmt }}; 
              }
            {% endfor %}
          {% endfor %}

          var sortable = [];
          for (var obj in QuantityBasedDiscountPerProductObj) {
            sortable.push([obj, QuantityBasedDiscountPerProductObj[obj]]);
          }

          for(var i=sortable.length-1; i >= 0 && flag == 0; i--)
          {
            if(parseInt(product_quantity) >= parseInt(sortable[i][0]))
            {
                DiscountAmount = ((parseFloat(Product_Price) -  parseFloat(Product_Price) * parseFloat(sortable[i][1]))* product_quantity ).toFixed(2);
              productArr[singleproduct]["Discount_For_Customer"] = currencyFormat +" "+ DiscountAmount.toString();
              flag = 1;
            }
          }
        {% endif %}
      }
       
        for(var discount in commissionAr)
    	 {
    			var responseProductId = commissionAr[discount].variantId;
        		if(getProductId == responseProductId)
              	{
                  if(CommissionDiscountType == "FixedDollarAmount")
                  {
                    currencyFormat = "$";
                    var DiscountAmount = (CalculateFixedAmountDiscount(parseFloat(Product_Price),parseFloat(Item_price),parseFloat(commissionAr[discount].BronzeDiscount*100),parseFloat(productArr[singleproduct].product_quantity))).toFixed(2);               		
                    var CommissionAmount = parseFloat(commissionAr[discount].Commissionforsalerep*100*product_quantity).toFixed(2);
                  
                  }
                  else
                  {
                    var DiscountAmount = (CalculateDiscount(parseFloat(Product_Price),parseFloat(Item_price),parseFloat(commissionAr[discount].BronzeDiscount),parseFloat(productArr[singleproduct].product_quantity))).toFixed(2);               		
                    var CommissionAmount = (CalculateCommission(DiscountAmount,parseFloat(commissionAr[discount].Commissionforsalerep))).toFixed(2);
                  
                  }
        			
					  if(moneyformate == format)
					  {
						    DiscountAmount = DiscountAmount.replace(".",",");							
							CommissionAmount = CommissionAmount.replace(".",",");							
                      }
                    	
                  if(serverData.select.QuantityBasedDiscountInInvoices)
                  {
                    if( flag == 0 )
                    {
                      productArr[singleproduct]["Discount_For_Customer"] = "No Discount";
                  	}
                  }
                  else{
                      //checking for applying dicount	
                      if(commissionAr[discount].BronzeDiscount == 0)
                        {
                          productArr[singleproduct]["Discount_For_Customer"] = "No Discount";
                        }
                      else{
                        	productArr[singleproduct]["Discount_For_Customer"] = currencyFormat +" "+ DiscountAmount.toString();
                      }
                  }
                     
                      //checking for applying commission		
                      if(commissionAr[discount].Commissionforsalerep == 0 )
                      	{
                        	productArr[singleproduct]["Commission_Amount"] = "No Commission";
                      	}
                      else{
                      		productArr[singleproduct]["Commission_Amount"] = currencyFormat +" "+ CommissionAmount.toString();                      	
    			     	}						
              	}
       }
	}
  }
  
  if(CommissionDiscountOn == "ProductType")
  {
	for(singleproduct in productArr)
	{
      var getProductType = productArr[singleproduct].product_type;
      Product_Price = (productArr[singleproduct].product_price);
      Item_price = (productArr[singleproduct].Item_Price);
      if(getProductType == "" )
        {
            var getProductType = "All Other Products";          
        }
      
       var flag = 0;
      var getProductId = productArr[singleproduct].variantId;
      product_quantity = (productArr[singleproduct].product_quantity); 
      
      if(serverData.select.QuantityBasedDiscountInInvoices)
      {
        {% if shop.metafields.SalesTeamQtyDiscount %}
          var QuantityBasedDiscountPerProductObj = {};

          {%for salesTeamInfo in shop.metafields.SalesTeamQtyDiscount %}
            {% assign QuantityBasedDiscountPerProductTable = salesTeamInfo | last %}
            {% for product in QuantityBasedDiscountPerProductTable %}
              if(getProductId == {{ product.VariantId }})
              {
                  QuantityBasedDiscountPerProductObj[{{ product.quantity }}] = {{ product.DiscountAmt }}; 
              }
            {% endfor %}
          {% endfor %}

          var sortable = [];
          for (var obj in QuantityBasedDiscountPerProductObj) {
            sortable.push([obj, QuantityBasedDiscountPerProductObj[obj]]);
          }

          for(var i=sortable.length-1; i >= 0 && flag == 0; i--)
          {
            if(parseInt(product_quantity) >= parseInt(sortable[i][0]))
            {
              DiscountAmount = ((parseFloat(Product_Price) -  parseFloat(Product_Price) * parseFloat(sortable[i][1]))* product_quantity ).toFixed(2);
            productArr[singleproduct]["Discount_For_Customer"] = currencyFormat +" "+ DiscountAmount.toString();
              flag = 1;
            }
          }
        {% endif %}
      }
      
      for(var discount in commissionAr)
    	{
    			var responseProductType = commissionAr[discount].type;
        		if(getProductType.toLowerCase() == responseProductType.toLowerCase())
              	{
        			var DiscountAmount = (CalculateDiscount(parseFloat(Product_Price),parseFloat(Item_price),parseFloat(commissionAr[discount].ClientDiscount),parseFloat(productArr[singleproduct].product_quantity))).toFixed(2);               		
                    var CommissionAmount = (CalculateCommission(DiscountAmount,parseFloat(commissionAr[discount].ClientCommission))).toFixed(2);
                  
					  if(moneyformate == format)
					  {
						    DiscountAmount = DiscountAmount.replace(".",",");							
							CommissionAmount = CommissionAmount.replace(".",",");							
                      }
                    					  	
                      //checking for applying dicount
                  if(serverData.select.QuantityBasedDiscountInInvoices)
                  {
                    if( flag == 0 )
                    {
                      productArr[singleproduct]["Discount_For_Customer"] = "No Discount";
                  	}
                  }
                  else{
                      if(commissionAr[discount].ClientDiscount == 0)
                        {
                          productArr[singleproduct]["Discount_For_Customer"] = "No Discount";
                        }
                      else{
                        	productArr[singleproduct]["Discount_For_Customer"] = currencyFormat +" "+ DiscountAmount.toString();
                      }
                  }
                     
                      //checking for applying commission		
                      if(commissionAr[discount].ClientCommission == 0 )
                      	{
                        	productArr[singleproduct]["Commission_Amount"] = "No Commission";
                      	}
                      else{
                      		productArr[singleproduct]["Commission_Amount"] = currencyFormat +" "+ CommissionAmount.toString();                      	
    			     	}						
              	}
       }
	}
  } 
  
  //Show Selected products with discount and commission applied
  ShowAppiedDiscountCommissionProducts();
}

//Get Customer Discount and Salesrep Commission per rep
function getCommissionPerRep(productArr,commissionAr,currencyFormat)
{
 var Product_Price,Item_price;
	for(singleproduct in productArr)
	{
      var getSalesRepId = "{{customer.id}}";
      Product_Price = (productArr[singleproduct].product_price);
      Item_price = (productArr[singleproduct].Item_Price);
     
      var flag = 0;
      var getProductId = productArr[singleproduct].variantId;
      product_quantity = (productArr[singleproduct].product_quantity); 
      
      if(serverData.select.QuantityBasedDiscountInInvoices)
      {
        {% if shop.metafields.SalesTeamQtyDiscount %}
          var QuantityBasedDiscountPerProductObj = {};

          {%for salesTeamInfo in shop.metafields.SalesTeamQtyDiscount %}
            {% assign QuantityBasedDiscountPerProductTable = salesTeamInfo | last %}
            {% for product in QuantityBasedDiscountPerProductTable %}
              if(getProductId == {{ product.VariantId }})
              {
                  QuantityBasedDiscountPerProductObj[{{ product.quantity }}] = {{ product.DiscountAmt }}; 
              }
            {% endfor %}
          {% endfor %}

          var sortable = [];
          for (var obj in QuantityBasedDiscountPerProductObj) {
            sortable.push([obj, QuantityBasedDiscountPerProductObj[obj]]);
          }

          for(var i=sortable.length-1; i >= 0 && flag == 0; i--)
          {
            if(parseInt(product_quantity) >= parseInt(sortable[i][0]))
            {
              DiscountAmount = ((parseFloat(Product_Price) -  parseFloat(Product_Price) * parseFloat(sortable[i][1]))* product_quantity ).toFixed(2);
           productArr[singleproduct]["Discount_For_Customer"] = currencyFormat +" "+ DiscountAmount.toString();
              flag = 1;
            }
          }
        {% endif %}
      }
      
      for(var discount in commissionAr)
    	{
    			var responseSalesRepId = commissionAr[discount].SalesRepId;
        		if(getSalesRepId == responseSalesRepId)
              	{
        			var DiscountAmount = (CalculateDiscount(parseFloat(Product_Price),parseFloat(Item_price),parseFloat(commissionAr[discount].GoldDiscount),parseFloat(productArr[singleproduct].product_quantity))).toFixed(2);               		
                    var CommissionAmount = (CalculateCommission(DiscountAmount,parseFloat(commissionAr[discount].Commissionforsalerep))).toFixed(2);
                      	
					   if(moneyformate == format)
					   {
						    DiscountAmount = DiscountAmount.replace(".",",");							
							CommissionAmount = CommissionAmount.replace(".",",");							
                       }                   

                  if(serverData.select.QuantityBasedDiscountInInvoices)
                  {
                    if( flag == 0 )
                    {
                      productArr[singleproduct]["Discount_For_Customer"] = "No Discount";
                  	}
                  }
                  else
      			  {
                      if(commissionAr[discount].GoldDiscount == 0)
                        {
                          productArr[singleproduct]["Discount_For_Customer"] = "No Discount";
                        }
                      else{
                        	productArr[singleproduct]["Discount_For_Customer"] = currencyFormat +" "+DiscountAmount.toString();
                      }
                  }
                     
                      //checking for applying gold commission		
                      if(commissionAr[discount].Commissionforsalerep == 0 )
                      	{
                        	productArr[singleproduct]["Commission_Amount"] = "No Commission";
                      	}
                      else{
                      		productArr[singleproduct]["Commission_Amount"] = currencyFormat +" "+ CommissionAmount.toString();                      	
    			     	}
					
              	}
    		}

	}
  
  //Show Selected products with discount and commission applied
  ShowAppiedDiscountCommissionProducts();
}      
  
  //Show Selected products with discount and commission applied
  function ShowAppiedDiscountCommissionProducts()
  {     
    var _currencyFormat = currencyFormat;
    if(Clientproduct != 0)
    {
      if(serverData.CommissionDiscountOn.CommissionDiscountOn=="ProfitMargin")
      {
        var customersalerows = '<tr id="ClientInvoicerow">'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;"> </th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product Name</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Size</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Quantity</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Item Price</th>';
              if(serverData.PriceListFeature)
              {
              customersalerows += '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Wholesale Price</th>';
              }
              customersalerows += '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Total Price</th></tr>';

              //Selected Products Table in Customer Order Page
              for(var data = 0; data < Clientproduct.length; data++)
              {
                var propertiesArr = Clientproduct[data].propertiesArr;
                var prodProperties = "";
                for(var i=0;i<propertiesArr.length;i++){
                  if(propertiesArr[i].value != ''){
                    prodProperties += prodProperties == "" ? propertiesArr[i].name +":"+propertiesArr[i].value : ","  + propertiesArr[i].name +":"+propertiesArr[i].value;
                  }
                  
                  if(i == propertiesArr.length-1){
                    prodProperties = "(" + prodProperties +")";
                  }
                 }
                 customersalerows += '<tr id="row' + (Clientproduct[data].variantId) +'" class = "class="Polaris-DataTable__TableRow"">'+
                                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
                                  '<img class="removeIcon" src="{{ 'minusIcon.png' | asset_img_url: '50x'  }}" style="cursor: pointer;"onclick="RemoveClientInvoiceProduct('+Clientproduct[data].variantId+')"/></td>'+
                                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><img src='+Clientproduct[data].Image+' height="100"></td>'+
                                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(Clientproduct[data].title)+" "+(prodProperties)+'</td>'+
                                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(Clientproduct[data].product_size)+'</td>'+
                                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(Clientproduct[data].product_quantity)+'</td>'+
                                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(currencyFormat +" "+ parseFloat(Clientproduct[data].retailPrice).toFixed(2))+'</td>';
                                  if(serverData.PriceListFeature)
                                  {
                                  customersalerows += '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(currencyFormat +" "+ parseFloat(Clientproduct[data].Item_Price).toFixed(2))+'</td>';
                                  }
                                  customersalerows += '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(currencyFormat +" "+ parseFloat(Clientproduct[data].product_price).toFixed(2))+'</td>'+
                                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><div class="Polaris-ButtonGroup__Item"><button type="button" class="Polaris-Button Polaris-Button--primary" style="font-size:18px;padding-left: 35px;padding-right: 35px;" onclick="RemoveClientInvoiceProduct('+Clientproduct[data].variantId+')"><span class="Polaris-Button__Content"><span>Remove</span></span></button></td></tr>';

              }
      }
      else
      {
                   var customersalerows = '<tr id="ClientInvoicerow">'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;"> </th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product Name</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Size</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Quantity</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Item Price</th>';
              if(serverData.PriceListFeature)
              {
              customersalerows += '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Wholesale Price</th>';
              }
              customersalerows += '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Total Price</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;white-space: pre-wrap;">Discounted Price for Customer</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;white-space: pre-wrap;">SalesRep Commission</th></tr>';

              for(var data = 0; data < Clientproduct.length; data++)
              {
               var propertiesArr = Clientproduct[data].propertiesArr;
                var prodProperties = "";
                for(var i=0;i<propertiesArr.length;i++){
                  if(propertiesArr[i].value != ''){
                    prodProperties += prodProperties == "" ? propertiesArr[i].name +":"+propertiesArr[i].value : ","  + propertiesArr[i].name +":"+propertiesArr[i].value;
                  }
                  
                  if(i == propertiesArr.length-1){
                    prodProperties = "(" + prodProperties +")";
                  }
                 }
                 var AfterUpdate = "AfterUpdate";
                 customersalerows += '<tr id="row' + (Clientproduct[data].variantId) +'" class = "class="Polaris-DataTable__TableRow"">'+
                                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
                                  '<img class="removeIcon" src="{{ 'minusIcon.png' | asset_img_url: '50x'  }}" style="cursor: pointer;"onclick="RemoveClientInvoiceProduct('+Clientproduct[data].variantId+')"/></td>'+
                                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><img src='+Clientproduct[data].Image+' height="100"></td>'+
                                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(Clientproduct[data].title)+" "+(prodProperties)+'</td>'+
                                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(Clientproduct[data].product_size)+'</td>'+
                                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><div class="number"><span style="cursor:pointer;" onclick="minusQuantity('+Clientproduct[data].variantId+',\'true\')" class="minus">-</span><input onchange="AddProductInClientInvoice(\''+ Clientproduct[data].title +'\',\''+ Clientproduct[data].Item_Price +'\',\''+ Clientproduct[data].Image +'\',\''+ Clientproduct[data].title +'\',\''+Clientproduct[data].variantId+'\',\''+Clientproduct[data].product_size+'\',\''+AfterUpdate+'\')" type="text" style="width:2.5em;text-align:center;padding: 10px 0px;" value='+Clientproduct[data].product_quantity+' id="quantity_'+Clientproduct[data].variantId+'"><span style="cursor:pointer;" onclick="plusQuantity('+Clientproduct[data].variantId+',\'true\')" class="plus">+</span></div></td>'+
                                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(currencyFormat +" "+ parseFloat(Clientproduct[data].retailPrice).toFixed(2))+'</td>';
                                   if(serverData.PriceListFeature)
                                  {
                                  customersalerows += '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(currencyFormat +" "+ parseFloat(Clientproduct[data].Item_Price).toFixed(2))+'</td>';
                                  }
                                  customersalerows += '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(currencyFormat +" "+ parseFloat(Clientproduct[data].product_price).toFixed(2))+'</td>'+
                                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ (Clientproduct[data].Discount_For_Customer)+'</td>'+
                                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ ((Clientproduct[data].Commission_Amount))+'</td></tr>';
              }
              
      }
document.getElementById( 'productTable' ).innerHTML = customersalerows;
$('#productAddedMsg').text("Product Added");
$("#productAddedMsg").show().delay(2000).fadeOut();
}
  }
  //Client Invoice Custom Tiers discount and Commission
   function ApplyInvoiceDiscount(thisObj , rowid)
	{
      var _currencyFormat = currencyFormat;
      var price = 0;
      discountname = thisObj.options[thisObj.selectedIndex].text;
      var Producttitle = document.getElementById("Title"+rowid).innerHTML.replace("&amp;", "&");
  	  
	  for(var singleProduct in Clientproduct)
      {
        	if(Clientproduct[singleProduct].title.trim() == Producttitle.trim())
            {
        		price = (Clientproduct[singleProduct].product_price);
            }
      }

      for(var count in  ClientInvoiceDiscount)
      {
        	var discountName2 = ClientInvoiceDiscount[count].DiscountName.toString();
        	if(discountName2.toLowerCase() == discountname.toLowerCase())
            {
            	var discount = ClientInvoiceDiscount[count].DiscountRate;
        		var commission = ClientInvoiceDiscount[count].CommissionRate;
              if(serverData.CommissionDiscountOn.CommissionDiscountOn=="Product" && serverData.CommissionDiscountOn.CommissionDiscountType == "FixedDollarAmount")
              {
                var _discount =  (parseFloat(price) - (parseFloat(discount))).toFixed(2);
              	var _commission = (CalculateFixedAmountCommission(parseFloat(_discount ),commission)).toFixed(2);
              }
              else
              {
                var _discount =  (parseFloat(price) - (parseFloat(price*discount))).toFixed(2);
              	var _commission = (CalculateCommission(parseFloat(_discount ),commission)).toFixed(2);
              }
        	  	
    			document.getElementById("Discount"+rowid).innerHTML = _currencyFormat + _discount;
              	document.getElementById("Commission"+rowid).innerHTML = _currencyFormat + _commission;
            }
      }

	  if(discountname == "No DiscountType")
      {
        document.getElementById("Discount"+rowid).innerHTML = "No Discount";
        document.getElementById("Commission"+rowid).innerHTML = "No Commission";
      }
	}
  
  //Base Model function
  var onSuccessGetbaseModel = function (response,$) 
  {    
      var currency = "{{shop.currency}}";         
	  currencyFormat = response.moneyformat;

        {% for currency in shop.enabled_currencies %}
        {% if currency.iso_code == shop.currency %}
            money = "{{ currency.symbol }}";
            moneyformate ="{{ currency.symbol }}";
            {% break %}
        {% endif %}
        {% endfor %}

       $("#CustomerOrders_Sent").text(response.AllOrdersCount.TotalCustomerOrdersInvoiceSent);
	   $("#CustomerOrders_Paid").text(response.AllOrdersCount.TotalCustomerOrderInvoicePaid); 
       $("#WholesaleOrders_Sent").text(response.AllOrdersCount.TotalWholesaleOrdersInvoiceSent); 
	   $("#WholesaleOrder_Paid").text(response.AllOrdersCount.TotalWholesaleOrderInvoicePaid); 
	   $("#AffiliateOrders_Paid").text(response.AllOrdersCount.TotalAffiliatePaidOrders);
       $("#DiscountCodeOrders_Paid").text(response.AllOrdersCount.TotalCouponCodePaidOrders); 
	   $("#TagCustomerOrders_Paid").text(response.AllOrdersCount.TotalCustomerOrders);   
	   $("#POSOrders_Paid").text(response.AllOrdersCount.TotalPOSOrder);   

	   $("#CustomerOrders_Earning").text(currency+" "+response.AllOrdersEarnings.CustomerOrdersEarning.toString()); 
       $("#WholesaleOrders_Earning").text(currency+" "+response.AllOrdersEarnings.WholesaleOrdersEarning.toString());
	   $("#AffiliateOrders_Earning").text(currency+" "+response.AllOrdersEarnings.AffiliateOrdersEarning.toString());
       $("#DiscountCode_Earning").text(currency+" "+response.AllOrdersEarnings.CouponCodeEarning.toString());
	   $("#TeamLead_Commission").text(currency+" "+response.AllOrdersEarnings.ReferralCommission.toString()); 
	   $("#Customer_Commission").text(currency+" "+response.AllOrdersEarnings.CustomerCommission.toString());         		
       $("#POS_Commission").text(currency+" "+response.AllOrdersEarnings.POSCommission.toString());     
    
      if(response.CouponCodeForSalesRep == null)
  		 {
 		   $("#CouponCode").text("Coupon Code Not Set");
         }
		 else
		 {
          	$("#myInput").val("Hey use my discount coupon code "+response.CouponCodeForSalesRep.DiscountCode+" and get discounted products");
          	$("#CouponCode").text(response.CouponCodeForSalesRep.DiscountCode);
          	$("#dis_amt").text(response.CouponCodeForSalesRep.CustomerDiscount+"%");
          	$("#com_amt").text(response.CouponCodeForSalesRep.SalesRepCommission+"%");
		 }        
         
	   if(response.select.Tagcustomer)
		{  
          	var li = "";  
			for(var cust in response.repcustomers)
			  {
			   li += '<li onclick="showSelected(\''+response.repcustomers[cust].CustomerId+'\',\''+response.repcustomers[cust].CustomerTags+'\',\''+response.repcustomers[cust].CustomerMailid+'\',\''+ response.repcustomers[cust].CustomerName.replace("'","\\'") +'\')"><a href="#" id="'+response.repcustomers[cust].CustomerMailid+'">' + response.repcustomers[cust].CustomerName + '</a></li>';
			  }  
			document.getElementById('custnamelist').innerHTML = li;
		 }
		else
		{	  
          $("#CustomerWidget").hide();
		  $(".allcustomers").hide();
		}

    
var i;
    
var orderRow = '<tr>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric month" scope="col" style="height: 54px;">Month </th>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric clientInvoice" scope="col" style="height: 54px;">Client Invoice Orders</th>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric clientInvoice" scope="col" style="height: 54px;">Client Invoice Commission</th>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric wholesaleColoumn" scope="col" style="height: 54px;">Wholesale Orders</th>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric wholesaleColoumn" scope="col" style="height: 54px;">Total Wholesale Purchase</th>'+
"<th data-polaris-header-cell='true' class='Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric affiliateColumn' scope='col' style='height: 54px;'>Affiliate Orders </th>"+
"<th data-polaris-header-cell='true' class='Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric affiliateColumn' scope='col' style='height: 54px;'>Affilate Commission</th>"+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric couponeColumn" scope="col" style="height: 54px;">CouponCode Orders</th>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric couponeColumn" scope="col" style="height: 54px;">CouponCode Commission</th>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric customerColumn" scope="col" style="height: 54px;">Customer Orders</th>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric customerColumn" scope="col" style="height: 54px;">Customer Commission</th>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric POSColumn" scope="col" style="height: 54px;">POS Orders </th>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric POSColumn" scope="col" style="height: 54px;">POS Commission</th></tr>';    
    for(var count = 0; count<6; count++)
    {
      orderRow += '<tr id="row' +count +'" class = "class="Polaris-DataTable__TableRow"">'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric month" style="height: 72px;">'+(response.salesrepCustomerOrders.length > 0 ? response.salesrepCustomerOrders[count].Month : "")+'</td>'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric clientInvoice" style="height: 72px;">'+(response.salesrepCustomerOrders.length > 0 ? response.salesrepCustomerOrders[count].CustomerOrderCount : "")+'</td>'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric clientInvoice" style="height: 72px;">'+currency +" "+ (response.salesrepCustomerOrders.length > 0 ? response.salesrepCustomerOrders[count].CustomerOrderCommission.toString() : "")+'</td>'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric wholesaleColoumn" style="height: 72px;">'+(response.salesrepWholesaleOrders.length > 0 ? response.salesrepWholesaleOrders[count].WholesaleOrderCount : "" )+'</td>'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric wholesaleColoumn" style="height: 72px;">'+currency +" "+ (response.salesrepWholesaleOrders.length > 0 ? response.salesrepWholesaleOrders[count].WholesalePerchase : "")+'</td>'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric affiliateColumn" style="height: 72px;">'+(response.salesrepAffiliateOrders.length > 0 ? response.salesrepAffiliateOrders[count].AffiliateOrderCount : "")+'</td>'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric affiliateColumn" style="height: 72px;">'+currency + " " + (response.salesrepAffiliateOrders.length > 0 ? response.salesrepAffiliateOrders[count].AffiliateOrderCommission.toString() : "")+'</td>'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric couponeColumn" style="height: 72px;">'+(response.salesrepCouponOrders.length > 0 ? response.salesrepCouponOrders[count].CouponCodeOrderCount : "")+'</td>'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric couponeColumn" style="height: 72px;">'+ currency+ " " + (response.salesrepCouponOrders.length > 0 ? response.salesrepCouponOrders[count].CouponCodeOrderCommission.toString() : "")+'</td>'+
	  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric customerColumn" style="height: 72px;">'+(response.TaggedCustomerOrdersDetails.length > 0 ? response.TaggedCustomerOrdersDetails[count].TagCustomerOrderCount : "")+'</td>'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric customerColumn" style="height: 72px;">'+currency+ " " + ( response.TaggedCustomerOrdersDetails.length > 0 ? response.TaggedCustomerOrdersDetails[count].TagCustomerCommission.toString() : "")+'</td>'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric POSColumn" style="height: 72px;">'+(response.POSOrdersDetails.length > 0 ? response.POSOrdersDetails[count].POSOrderCount : "")+'</td>'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric POSColumn" style="height: 72px;">'+currency+ " " + (response.POSOrdersDetails.length > 0 ? response.POSOrdersDetails[count].POSCommission.toString() : "")+'</td></tr>';
    } 
    document.getElementById('orderTable').innerHTML = orderRow;
	
	var ProductRow = '<tr>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric Order" scope="col" style="height: 54px;">Order Number</th>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric Date" scope="col" style="height: 54px;">Order Date</th>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric Customer" scope="col" style="height: 54px;">Customer Name</th>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric Payment" scope="col" style="height: 54px;">Payment</th>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric Fulfillment" scope="col" style="height: 54px;">Fulfillment</th>'+
'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric Total" scope="col" style="height: 54px;">Total</th></th></tr>';  


{% for order in customer.orders %}
    var TrackingNumber = 0;
    var ShipDate = new Date();
    {%for data in order.fulfillments%}
    	if(TrackingNumber == 0)
        {
    		TrackingNumber = data.tracking_number;
          	ShipDate = data.created_at;
        }
    	else
          break;
    {%endfor%}
    {%for items in order.line_items%}
     var totalPrice = '{{items.original_line_price| money_without_currency}}';
     totalPrice = totalPrice.replaceAll(",", "");

         ProductsArray.push({
          "OrderNumber":{{order.order_number}},
          "image" :'{{ items.image | img_url: '100x100' | img_tag }}' , 
          "quantity" :  {{items.quantity}},
          "title" : '{{items.title}}',
          "price" : totalPrice,
          "Totalprice" : ''+ moneyformate +'{{items.original_line_price| times: items.quantity| money_without_currency}}',
          "subtotal":''+ moneyformate +'{{order.subtotal_price| money_without_currency}}',
          "tax":''+ moneyformate +'{{order.tax_price| money_without_currency}}',
          "shipping":''+ moneyformate +'{{order.shipping_price| money_without_currency}}',
          "total":''+ moneyformate +'{{order.total_price| money_without_currency}}',
          "TrackingNumber":TrackingNumber,
          "discountedTotalPrice":'{{items.total_discount| money_without_currency}}', 
          "totalRefundedAmount":'{{order.total_refunded_amount| money_without_currency}}',
           "note":'{{order.note}}',
          "ShipDate":ShipDate,
    });
    {%endfor%}
    
              var orderName='{{order.name}}'    
              var orderNumber={{order.order_number}};
       var date='{{order.created_at| date: "%b %d, %y"}}';
       var name='{{order.customer.first_name}} {{order.customer.last_name}}';
       var financial='{{order.financial_status}}';
       var fulfillment='{{order.fulfillment_status}}';
       var total='${{order.total_price| money_without_currency}}'
      ProductRow += '<tr id="row' +count +'" class = "class="Polaris-DataTable__TableRow"">'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric month" style="height: 72px;"><u><a style="color:blue;" href="javascript:void(0)" onclick=showModelData('+orderNumber+',\'orderNumber\')>'+orderName+'</a></u></td>'+ 
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric date" style="height: 72px;">'+date+'</td>'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric name" style="height: 72px;">'+name+'</td>'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric financial" style="height: 72px;">'+financial+'</td>'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric fulfillment" style="height: 72px;">'+fulfillment+'</td>'+
      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric total" style="height: 72px;">'+total+'</td></tr>';
    {%endfor%}
  
    document.getElementById('ViewMyOrder').innerHTML = ProductRow;         
    

    if(!response.select.CustomerInvoice && !response.select.ClientDiscount &&!response.select.CommissionPerRep)
    {
      	    document.getElementById("sr_CustomerOrder_head").style.display = "none";
      		document.getElementById("ClientWidget").style.display = "none";
      		
      		var ClientElement = [];
      		ClientElement = document.getElementsByClassName("clientInvoice");
      		var i;
    		for (i = 0; i < ClientElement.length; i++) 
            {
        		ClientElement[i].style.display = "none";
    		}      		
    }

    if(!response.select.WholesaleInvoice && !response.select.wholesaleqtydiscount)
    {
      		document.getElementById("sr_Wholesale_head").style.display = "none";
      		document.getElementById("WholesaleWidget").style.display = "none";
      		
      		var WholesaleElement = [];
      		WholesaleElement = document.getElementsByClassName("wholesaleColoumn");
      		var i;
    		for (i = 0; i < WholesaleElement.length; i++) 
            {
        		WholesaleElement[i].style.display = "none";
    		}
      		
    }

    if(!response.select.AffiliateLink && !response.select.AffiliateLinkCommissionPerRep)
    {
      		document.getElementById("sr_Affiliate_head").style.display = "none";
      		document.getElementById("AffiliateWidget").style.display = "none";
      		
      		var affiliateElement = [];
      		affiliateElement = document.getElementsByClassName("affiliateColumn");
      		var i;
    		for (i = 0; i < affiliateElement.length; i++) 
            {
        		affiliateElement[i].style.display = "none";
    		}
      		
    }

    if(!response.select.CouponeCode)
    {
      		document.getElementById("sr_Discount_head").style.display = "none";
     		document.getElementById("CouponeCodeWidget").style.display = "none";
      		
      		var CouponeElement = [];
      		CouponeElement = document.getElementsByClassName("couponeColumn");
      		var i;
    		for (i = 0; i < CouponeElement.length; i++) 
            {
        		CouponeElement[i].style.display = "none";
    		}
    }
    
    if(!response.select.POS)
    {
      		document.getElementById("POSWidget").style.display = "none";
      		
      		var ClientElement = [];
      		ClientElement = document.getElementsByClassName("POSColumn");
      		var i;
    		for (i = 0; i < ClientElement.length; i++) 
            {
        		ClientElement[i].style.display = "none";
    		}      		
    }
		
    if(!response.select.referralpage)
    {     
	   document.getElementById("sr_Team_head").style.display = "none"; 	  
       $("#TeamleadWidget").hide();  	  		      
    }
	else
	{
	 //Get Team Details
	  if(response.teammemberdetails!= 0)
	   {   
		 var option;
		   for(var info in response.teammemberdetails)
			{ 
			  var RepName = response.teammemberdetails[info].Name;
              var Repid = response.teammemberdetails[info].Id;
			  option += '<option value="'+j+'" id="'+Repid+'">'+ RepName + '</option>';
              if(info == 0)
              {
                var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?customerId="+Repid+"&customerName="+RepName+"&data=18";
                $.get(
                  urlVal,
                  function (data, status) {  
                    $('#TeamManagerOrders').append(onSuccessTeamMemberData(data.AllOrdersCommission)); 
                    if(data.AllOrdersCommission.length > 0)
                    {
                        TeamManagerOrders.push(data.AllOrdersCommission); 
                    }
                  }); 
              }
              j++;		
			}
		   $('#repname').append(option);
		}
	  else
	   {         
		$("#NoTeamDetails").show();
		document.getElementById("sr_Team_head").style.display = "none"; 	  
		$("#TeamleadWidget").hide(); 
	   }
	}
    
    if(response.select.referralpage)
    {
      document.getElementById("TeamSignUpPage").innerHTML = "{{shop.url}}/pages/sales-representative-sign-up?manager={{customer.first_name| downcase }}{{customer.id | modulo:1000}}";
      $("#TeamSignUpPage").attr('href',"{{shop.url}}/pages/sales-representative-sign-up?manager={{customer.first_name| downcase }}{{customer.id | modulo:1000}}");  
    }

    var shopurl = window.location.protocol +"//"+ window.location.hostname;
	if((response.select.microsites && response.select.AffiliateLink) || (response.select.microsites&&response.select.AffiliateLinkCommissionPerRep))
    {
        $("#repbio").val(response.rep_info.bio);
		  if(response.rep_info.uniquelink == null || response.rep_info.uniquelink == " ")
		  {	                       
			  document.getElementById("affiliate_link").innerHTML = response.SingleSalesRep.SalesRepAffiliateUrl;
			  $("#affiliate_link").attr('href',response.SingleSalesRep.SalesRepAffiliateUrl);                                  
		  }
		  else{
			  $("#uniquelink").val(response.rep_info.uniquelink);
			  document.getElementById("affiliate_link").innerHTML = shopurl + "/" +response.rep_info.uniquelink;
			  $("#affiliate_link").attr('href',response.SingleSalesRep.SalesRepAffiliateUrl);
			  document.getElementById("aff_link").innerHTML = shopurl + "/" + response.rep_info.uniquelink;
			  $("#aff_link").attr('href',response.SingleSalesRep.SalesRepAffiliateUrl);
         
		  }
    }
	else
	{
		 document.getElementById("sr_Yourbio_head").style.display = "none";
	   document.getElementById("affiliate_link").innerHTML = response.SingleSalesRep.SalesRepAffiliateUrl;
	   $("#affiliate_link").attr('href',response.SingleSalesRep.SalesRepAffiliateUrl);
	}
	//Select OneTimeCoupons table from Discount page
    //Check One time coupon feature is selected or not
    if(!response.select.SalesrepCoupon)
    {
    	document.getElementById("salesrepcoupon").style.display = "none";
    }    
    else
    {
      	if(response.DiscountAndCommissionForCoupon != null)
		{
      		$("#max_dis_amt").text(response.DiscountAndCommissionForCoupon.SalesRepMaxDiscount+"%");
      		$("#commission").text(response.DiscountAndCommissionForCoupon.SalesRepCommission+"%");
		}   	
    }
  
   if("{{shop.name}}" != "enzo-milano")
	{
	   $(".ProRep").hide();
	}

	if("{{shop.url}}" != "https://ajmal-perfumes.myshopify.com")
	{  
      $("#dashheader").text("CURRENT MONTH");
    }    
    else{
         $("#dashheader").text("Current Month cycle: 5th - 4th");
    }
    
     //Get Tagged Clients to Salesrep
  if(response.select.Tagcustomer)
  {
    
    if(response.repcustomers != 0)
	{
		  var clientrows = '<tr>'+
				  '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;cursor: pointer;" id="customerFirstName">Name</th>'+
				  "<th data-polaris-header-cell='true' class='Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric' scope='col' style='height: 54px;'>Company Name</th>"+
				  '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Email</th></tr>';

		 for(var client in response.ClientOrders)
		 {
			var company = "";
			if(response.ClientOrders[client].companyName != null) 
             company = response.ClientOrders[client].companyName;	

			  clientrows += '<tr class="Polaris-DataTable__TableRow">'+                
			  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><span id="SpecialSpan" style="cursor: pointer; cursor: hand;" onclick=showModelData('+response.ClientOrders[client].CustomerId+',\'clientId\')>'+ (response.ClientOrders[client].ClientName)+'</span></td>'+
  		      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ company +'</td>'+
  		      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+response.ClientOrders[client].CustomerMailid+'</td></tr>';
		 }
		document.getElementById( 'ViewTaggedClient' ).innerHTML = clientrows;
		$("#TaggedClient").show();
	}
	else
	{
	  $("#norepclients").show();      
	}
  }
  else
    {
       document.getElementById("sr_Clients_head").style.display = "none";
       document.getElementById("sr_Lead_head").style.display = "none";     
	    var CustomerElement = [];
        CustomerElement = document.getElementsByClassName("customerColumn");
      		var i;
    		for (i = 0; i < CustomerElement.length; i++) 
            {
        		CustomerElement[i].style.display = "none";
    		}
    }  
	 
	 //Hide Client Invoice button
	  if(response.select.ClientDiscount==true){
		$("#Choice").hide();
	  }
	  else{
		$("#Choice").show();
	  } 

  if(response.select.ClientDiscount){
      $('#DiscountType').hide();
      $('#discountChoiceLabel').hide();
    } 
    else{
      $('#DiscountType').show();
      $('#discountChoiceLabel').show();
    }

	if(!response.select.CartSharing){
      $('#sr_SharedCart_head').hide();
    } 
    else{
      $('#sr_SharedCart_head').show();
    }

  var Time=500;    
     var ShowProductVariant=function (filter, searchtype) 
     {          
      var productarray=[];
      var AllProducts=[];
           jQuery.getJSON("/search/suggest.json", {
               s: filter,
               resources: {
               "types": ["product"],
               "limit": 10,
               "unavailable_products": "hide"
              }
           }).done(function(responseproducts) {
               AllProducts = responseproducts.resources.results.products;
               if(AllProducts.length>0)
               {
                 GetProductsByhandle(AllProducts,filter, searchtype);
               }
               else
               {
                 $("#clientSpinner").hide(); 
	   			 $("#wholesaleSpinner").hide(); 
                 $("#affiliateSpinner").hide();
                 $('#clientinvoicetable').hide();
                 $('#wholesaleinvoicetable').hide();	
                 $('#AffiliateProductTable').hide();
				 $('#SharedCarttable').hide();
               } 
             });   
      
   }
     
     var GetProductsByhandle=function(AllProducts,filter,searchtype)
     {
       var productarray=[];
	   for(var product = 0; product < AllProducts.length; product++)
       {
         $.ajax({
               type: 'GET',
               url: '/products/'+AllProducts[product].handle+'.js',
               dataType: 'json',
               }).done(function(data) {
                  productarray.push(data);
                 if(searchtype == "client")
                 {
                    ShowClientProducts(productarray,filter);
                 }
                 if(searchtype == "wholesale")
                 {
                    ShowWholesaleProducts(productarray,filter);
                 }
                 if(searchtype == "affiliate")
                 {
                    ShowAffiliateProducts(productarray,filter,response.CommissionDiscountOn.CommissionDiscountOn);
                 }
				 if(searchtype == "sharedcart")
                 {
                    ShowSharedCartProducts(productarray,filter,response.CommissionDiscountOn.CommissionDiscountOn);
                 } 
              })                               
         }
       }
         
     var showProductTimeOut=null;
     //searchKeywords the client products by product title
   $('#ProductSearchInput').keyup( function(){
    if($("#sr_customer_id").val() != "" || !serverData.PriceListFeature)
    {
      $("#SalesRep_order").html("");
      clearTimeout(showProductTimeOut);
      var filter = $("#ProductSearchInput").val().toLowerCase();
      var searchtype = "client";
       $('#clientinvoicetable').hide();
	    $("#clientSpinner").hide();
       if(filter!="")
       {       
         $("#clientSpinner").show();  
          if(showProductTimeOut==null)
          {
            showProductTimeOut=setTimeout(function(){ShowProductVariant(filter, searchtype)}, Time);
          }
          else
          {
            Time=500;
            showProductTimeOut=setTimeout(function(){ShowProductVariant(filter, searchtype)}, Time);         
          }
      }
    }
    else{
    $("#SalesRep_order").html("Please Select Customer and then add product");
    }
    });
    
      var ShowClientProducts=function(productarray,filter)
      {
            if(filter)
            {
              var orderRow = '<tr>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;"> </th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Image</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Add Quantity</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Title</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Variant Title</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Price</th>';
              if(serverData.PriceListFeature)
              {
                orderRow += '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Wholesale Price</th>';
              }
              orderRow += '</tr>';
      
                           for(var product = 0; product < productarray.length; product++)
                           {
                             for(var variant=0;productarray[product].variants.length>variant;variant++)
                             {
                                var discountedPrice = 0; 
                                var selectedCustomerTags = $('#sr_customer_tags').val();
                                if (serverData.AllWholesalePrices != null && serverData.AllWholesalePrices.hasOwnProperty(productarray[product].variants[variant].sku)) 
                                {           
                                    var prices = JSON.parse(serverData.AllWholesalePrices[productarray[product].variants[variant].sku]);

                                      var res = selectedCustomerTags.substr(selectedCustomerTags.indexOf("Price_Level_"));
                                      var tag = "";
                                      if(res.includes(","))
                                      {
  	                                    tag = res.substr(0, res.indexOf(','));
                                      }
                                      else
                                      {
  	                                    tag = res.substr(0);
                                      }
  
                                    if(tag.trim() != "")
                                    {
                                        discountedPrice = JSON.parse(prices)[tag.trim()];
                                    }
                                }
                               var BeforeUpdate = "BeforeUpdate";
                               var productTitle = productarray[product].title.replaceAll('\"',"");
                               productTitle = productTitle.replaceAll("\'","");
                               var variantTitle = productarray[product].variants[variant].option1.replaceAll('\"',"");
                               variantTitle = variantTitle.replaceAll("\'","");
                               var productprice =productarray[product].variants[variant].price/100;
                                discountedPrice = discountedPrice == 0 ? productprice : discountedPrice;
                                 orderRow += '<tr class="Polaris-DataTable__TableRow">'+
                                 '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
                                 '<img class="sr_productImage" src="{{ 'plusIcon.png' | asset_url }}" style="cursor: pointer;" onclick="AddProductInClientInvoice(\''+productTitle+'\',\''+productprice+'\',\''+productarray[product].images+'\',\''+productarray[product].type+'\',\''+productarray[product].variants[variant].id+'\',\''+variantTitle+'\',\''+BeforeUpdate+'\',\'0\',\''+discountedPrice+'\')"></td>'+
                                 '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><img class="sr_productImage" style="width:60px;" src="'+productarray[product].images+'"></td>'+
                                 '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><div class="number"><span style="cursor:pointer;" onclick="minusQuantity('+productarray[product].variants[variant].id+')" class="minus">-</span><input type="text" style="width:2.5em;text-align:center;padding: 10px 0px;" id="ClientInvoicequantity_'+productarray[product].variants[variant].id+'" value="1"><span style="cursor:pointer;" onclick="plusQuantity('+productarray[product].variants[variant].id+')" class="plus">+</span></div></td>'+
                                 '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productarray[product].title+'</td>'+
                                 '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productarray[product].variants[variant].option1+'</td>'+     
                                 '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productprice+  " " +currency+'</td>';
                                 if(serverData.PriceListFeature)
                                 {
                                 	orderRow += '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+discountedPrice+  " " +currency+'</td>';
                                }
                                orderRow += '</tr>';                                
                              }
                            }
                          document.getElementById('clienttable').innerHTML = orderRow; 
                          $('#clientinvoicetable').show();
                          $("#clientSpinner").hide();
                          $(".ToTop").addClass("hide"); 
                        }
                        else 
                        {
                          $('#clientinvoicetable').hide();			
                        }
             
   }
              
     //searchKeywords the wholesale products by product title              
    $('#WholesaleProductSearchInput').keyup( function(){
      clearTimeout(showProductTimeOut);
      var filter = $("#WholesaleProductSearchInput").val().toLowerCase();
       var searchtype = "wholesale";
       $('#wholesaleinvoicetable').hide();
	   $("#wholesaleSpinner").hide(); 
       if(filter!="")
       { 
         $("#wholesaleSpinner").show(); 
          if(showProductTimeOut==null)
          {
            showProductTimeOut=setTimeout(function(){ShowProductVariant(filter, searchtype)}, Time);
          }
          else
          {
            Time=500;
            showProductTimeOut=setTimeout(function(){ShowProductVariant(filter, searchtype)}, Time);
          }
       }
    });   

      var ShowWholesaleProducts=function(productarray,filter)
      {
            if(filter)
            {
              var orderRow = '<tr>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;"></th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Image</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Add Quantity</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Title</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Variant Title</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Price</th></tr>';
      
                         for(var product in productarray)
                           {
                             for(var variant=0;productarray[product].variants.length>variant;variant++)
                             {
                             var variantTitle = productarray[product].variants[variant].option1.replaceAll('\"',"");
                               variantTitle = variantTitle.replaceAll("\'","");
                               var productprice =productarray[product].variants[variant].price/100;
                                 orderRow += '<tr class="Polaris-DataTable__TableRow">'+
                                 '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
                                 '<img class="sr_productImage" src="{{ 'plusIcon.png' | asset_url }}" style="cursor: pointer;" onclick="AddProduct(\''+productarray[product].title+'\',\''+productprice+'\',\''+productarray[product].images+'\',\''+productarray[product].type+'\',\''+productarray[product].variants[variant].id+'\',\''+variantTitle+'\',\''+productarray[product].variants[variant].available+'\')"></td>'+                 
                                 '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><img class="sr_productImage" style="width:60px;" src="'+productarray[product].images+'"></td>'+
                                 '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><input type="text" style="width:90px;" id="quantity_'+productarray[product].variants[variant].id+'" placeholder="Quantity"></td>'+
                                 '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productarray[product].title+'</td>'+
                                 '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productarray[product].variants[variant].option1+'</td>'+     
                                 '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productprice+  " " +currency+'</td></tr>';                                                  
                                 
                              }
                            }
                                                                                                                                                    
                          document.getElementById('wholesaletable').innerHTML = orderRow; 
                          $('#wholesaleinvoicetable').show();
                          $("#wholesaleSpinner").hide(); 
             }
           else 
           {
             $('#wholesaleinvoicetable').hide();			
           }                                        
   }    
              
     //searchKeywords the affiliate products  by product title              
    $('#AffiliateProductSearchInput').keyup( function(){
      clearTimeout(showProductTimeOut);
      var filter = $("#AffiliateProductSearchInput").val().toLowerCase();
      var searchtype = "affiliate";
       $('#AffiliateProductTable').hide();
	   $("#affiliateSpinner").hide(); 
       if(filter!="")
       {        
         $("#affiliateSpinner").show(); 
          if(showProductTimeOut==null)
          {
            showProductTimeOut=setTimeout(function(){ShowProductVariant(filter, searchtype)}, Time);
          }
          else
          {
            Time=500;
            showProductTimeOut=setTimeout(function(){ShowProductVariant(filter, searchtype)}, Time);

          }

         $('#AffiliateCartProductTable').hide();
       }
      else
      {
      	$('#AffiliateProductTable').hide();
        $('#AffiliateCartProductTable').show();
      }
    });
     
      var ShowAffiliateProducts=function(productarray,filter,CommissionDiscountOn)
      {
            if(filter)
            {
               var orderRow = '<tr>'+
             '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product </th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product Title</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Price</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Commission</th>'+
              "<th data-polaris-header-cell='true' class='Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric' scope='col' style='height: 54px;'>Affiliate Link</th>"+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Share Link</th></tr>';

              if(CommissionDiscountOn=="ProductType")
              {
                   for(var product in productarray)
                   {
                             var producttype = productarray[product].type ;
                             if(producttype == "")
                             {
                               producttype = "all other products";
                             }
                             for(var productdata in response.AffiliateCommission)
                             {
                                if(producttype.toLowerCase() == response.AffiliateCommission[productdata].type)
                                {
                                 var currency = "{{shop.currency}}";
                                 var url = new URL(response.SingleSalesRep.SalesRepAffiliateUrl);
                                  var affiliateUrl = url.searchParams.get("ambassador");
                                 var url = "{{shop.url}}/products/"+productarray[product].handle+"/?ambassador="+affiliateUrl+"";

                                 for(var variant=0;productarray[product].variants.length>variant;variant++)
                                 {
                                    var productprice =productarray[product].variants[variant].price/100;
                                     orderRow += '<tr class="Polaris-DataTable__TableRow">'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><img class="sr_productImage" style="width:60px;" src="'+productarray[product].images+'"></td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productarray[product].title+'</td>'+     
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productprice +  " " +currency+'</td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+response.AffiliateCommission[productdata].Commission+'%</td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+url+'</td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
                                    '<a href="http://pinterest.com/pin/create/bookmarklet/?is_video=false&url='+url+'" class="ssbp-btn ssbp-pinterest" rel="nofollow"  data-ssbp-url="'+url+'" data-ssbp-site="Pinterest_force" target="_blank">'+ 
                                    '<img src="https://simplesharebuttons.com/images/somacro/pinterest.png" alt="Pinterest" style="width:35px;"/></a>'+
                                    '<a href="http://instagram.com/###?ref='+url+'" class="ig-b- ig-b-32"  target="_blank"><img src="https://badges.instagram.com/static/images/ig-badge-32.png" alt="Instagram"/></a>'+
                                    '<a href="https://twitter.com/share?url='+url+'&amp;text='+shopname+'" target="_blank"><img src="https://simplesharebuttons.com/images/somacro/twitter.png" alt="Twitter" style="width:35px;"/></a>'+
                                    '<a href="http://www.facebook.com/sharer.php?u='+url+'" target="_blank"><img src="https://simplesharebuttons.com/images/somacro/facebook.png" alt="Facebook" style="width:35px;"/></a>'+                               
                                    '</td></tr>';                                                                                                                 }
                                  }
                               }
                       }   
              }
              if(CommissionDiscountOn=="Product")
              {
                   for(var product in productarray)
                   {                                                                                
                                
                                 var currency = "{{shop.currency}}";
                                 var url = new URL(response.SingleSalesRep.SalesRepAffiliateUrl);
                                  var affiliateUrl = url.searchParams.get("ambassador");
                                 var url = "{{shop.url}}/products/"+productarray[product].handle+"/?ambassador="+affiliateUrl+"";

                                 for(var variant=0;productarray[product].variants.length>variant;variant++)
                                 {
                                   for(var productdata in response.AffiliateCommissionPerProduct)
                                   {
                                      var variantId = productarray[product].variants[variant].id ;
                                   if(variantId == response.AffiliateCommissionPerProduct[productdata].variantId)                                   
                                   {
                                     
                                     var productprice =productarray[product].variants[variant].price/100;
                                     var commission=Math.round((response.AffiliateCommissionPerProduct[productdata].Commission)*100);
                                     orderRow += '<tr class="Polaris-DataTable__TableRow">'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><img class="sr_productImage" style="width:60px;" src="'+productarray[product].images+'"></td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productarray[product].title+'</td>'+     
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productprice +  " " +currency+'</td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+commission+'%</td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+url+'</td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
                                    '<a href="http://pinterest.com/pin/create/bookmarklet/?is_video=false&url='+url+'" class="ssbp-btn ssbp-pinterest" rel="nofollow"  data-ssbp-url="'+url+'" data-ssbp-site="Pinterest_force" target="_blank">'+ 
                                    '<img src="https://simplesharebuttons.com/images/somacro/pinterest.png" alt="Pinterest" style="width:35px;"/></a>'+
                                    '<a href="http://instagram.com/###?ref='+url+'" class="ig-b- ig-b-32"  target="_blank"><img src="https://badges.instagram.com/static/images/ig-badge-32.png" alt="Instagram"/></a>'+
                                    '<a href="https://twitter.com/share?url='+url+'&amp;text='+shopname+'" target="_blank"><img src="https://simplesharebuttons.com/images/somacro/twitter.png" alt="Twitter" style="width:35px;"/></a>'+
                                    '<a href="http://www.facebook.com/sharer.php?u='+url+'" target="_blank"><img src="https://simplesharebuttons.com/images/somacro/facebook.png" alt="Facebook" style="width:35px;"/></a>'+                               
                                    '</td></tr>'; 
                                   }
                                   }
                                  
                                                                                                                                                    
                                 }
                       }
              }
              if(CommissionDiscountOn=="SalesRep")
              {
                   for(var product in productarray)
                   {
                        var salesrepId = "{{customer.id}}" ;
                             
                             for(var productdata in response.AffiliateCommissionPerRepModel)
                             {
                                if(salesrepId == response.AffiliateCommissionPerRepModel[productdata].SalesRepId)
                                {
                                 var currency = "{{shop.currency}}";
                                 var url = new URL(response.SingleSalesRep.SalesRepAffiliateUrl);
                                  var affiliateUrl = url.searchParams.get("ambassador");
                                 var url = "{{shop.url}}/products/"+productarray[product].handle+"/?ambassador="+affiliateUrl+"";

                                 for(var variant=0;productarray[product].variants.length>variant;variant++)
                                 {
                                    var productprice =productarray[product].variants[variant].price/100;
                                     orderRow += '<tr class="Polaris-DataTable__TableRow">'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><img class="sr_productImage" style="width:60px;" src="'+productarray[product].images+'"></td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productarray[product].title+'</td>'+     
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productprice +  " " +currency+'</td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+response.AffiliateCommissionPerRepModel[productdata].Commission+'%</td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+url+'</td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
                                    '<a href="http://pinterest.com/pin/create/bookmarklet/?is_video=false&url='+url+'" class="ssbp-btn ssbp-pinterest" rel="nofollow"  data-ssbp-url="'+url+'" data-ssbp-site="Pinterest_force" target="_blank">'+ 
                                    '<img src="https://simplesharebuttons.com/images/somacro/pinterest.png" alt="Pinterest" style="width:35px;"/></a>'+
                                    '<a href="http://instagram.com/###?ref='+url+'" class="ig-b- ig-b-32"  target="_blank"><img src="https://badges.instagram.com/static/images/ig-badge-32.png" alt="Instagram"/></a>'+
                                    '<a href="https://twitter.com/share?url='+url+'&amp;text='+shopname+'" target="_blank"><img src="https://simplesharebuttons.com/images/somacro/twitter.png" alt="Twitter" style="width:35px;"/></a>'+
                                    '<a href="http://www.facebook.com/sharer.php?u='+url+'" target="_blank"><img src="https://simplesharebuttons.com/images/somacro/facebook.png" alt="Facebook" style="width:35px;"/></a>'+                               
                                    '</td></tr>';                                                                                                                 
                                 }
                               }
                            }
                       }  
              }
             
              
                   document.getElementById('affiliatetable').innerHTML = orderRow; 
                   $('#AffiliateProductTable').show();
                   $("#affiliateSpinner").hide(); 
                }
            else 
            {
              $('#AffiliateProductTable').hide();			
            }
       }
	   
	$('#ViewTaggedClient #customerLastName,#customerFirstName').click(function(){
    var table = $(this).parents('table').eq(0)
    var rows = table.find('tr:gt(0)').toArray().sort(comparer($(this).index()))
    this.asc = !this.asc
    if (!this.asc){rows = rows.reverse()}
    for (var i = 0; i < rows.length; i++){table.append(rows[i])}
})
function comparer(index) {
    return function(a, b) {
        var valA = getCellValue(a, index), valB = getCellValue(b, index)
        return $.isNumeric(valA) && $.isNumeric(valB) ? valA - valB : valA.toString().localeCompare(valB)
    }
}
function getCellValue(row, index){ return $(row).children('td').eq(index).text() }
};
	
 var ProductsArray = [];
  function GetBaseModelData($){
      var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?customerId={{customer.id}}&data=1";
      $.get(
       	   urlVal,
           function (data, status) {
                onSuccessGetbaseModel(data,$);
        		var profileImageUrl = data.SingleSalesRep == undefined || data.SingleSalesRep == null || data.SingleSalesRep.ProfileImagePath == undefined || data.SingleSalesRep.ProfileImagePath == null || data.SingleSalesRep.ProfileImagePath == "" ? "https://salesrepapp.azurewebsites.net/Content/user.png" : data.SingleSalesRep.ProfileImagePath
        		$("#profilePath").attr("src",profileImageUrl)     		 
                $("#SR_App").show();
				$("#SR_Dashboard").show();
                $("#loadGif").hide();
                serverData=data;
                GsalesRepUrl=data.salesRepUrl;
             	Ghmac=data.hmac;
                GShopName = data.ShopName;
                GetSalesRepDataForLast2months($);
                DisplayCommisionDiscount(data);
                showAllSharedCart(data);
                if(serverData.PriceListFeature)
                {
                    AllWholesalePrices($);
                }
                else
                {
                    GetCartData();
                }
          }
       ); 
  }   

    var GetAllWholesalePrices = function($)
    {
       var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?customerId={{customer.id}}&data=30";
       $.get(
         urlVal,
         function (data, status) {
           serverData.AllWholesalePrices = data.AllWholesalePrices;
         }
       )
     }

      var GetSalesRepDataForLast2months = function($)
        {
           var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?customerId={{customer.id}}&customerName={{customer.first_name }}&data=18";
           $.get(
       	   urlVal,
           function (data, status) {
                 onSuccessGetSalesRepDataForLast2months(data,$);
                 }
               );
        }
        var onSuccessGetSalesRepDataForLast2months =  function(response,$)
        {
           var PreviousOrderRow = '<tr>'+
          '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Order Number</th>'+
          '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric date" scope="col" style="height: 54px;">Order Date</th>'+
          '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric name" scope="col" style="height: 54px;">Customer Name</th>'+
          '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric total" scope="col" style="height: 54px;">SubTotal</th>'+
          '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric commission" scope="col" style="height: 54px;">Commission </th>'+
          '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric type" scope="col" style="height: 54px;">Commission Type </th>'+
          '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric type" scope="col" style="height: 54px;">Print Invoice </th></tr>';

           var items='';
          for(var Previousorder in response.AllOrdersCommission)
          {
            if(Number.isInteger(parseInt(Previousorder)))
            {
              if(response.AllOrdersCommission[Previousorder].ProductTitle !=null)
				{
			     var products =response.AllOrdersCommission[Previousorder].ProductTitle.split(",");
				}
			  items='';
             for(var item in products)
             {
                if(products[item]!= "")
                {
                  items+='<li>'+products[item]+'</li>'
                }
             }
            PreviousOrderRow += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+
             '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric number" style="height: 72px;"><u><a style="color:blue" href="javascript:void(0)" onclick=showModelData('+response.AllOrdersCommission[Previousorder].OrderId+')>'+(response.AllOrdersCommission[Previousorder].orderNumber)+'</a></u></td>'+
             '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric date" style="height: 72px;">'+(response.AllOrdersCommission[Previousorder].orderDate)+'</td>'+
             '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric name" style="height: 72px;">'+(response.AllOrdersCommission[Previousorder].CustomerName)+'</td>'+
             '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric total" style="height: 72px;">'+(response.AllOrdersCommission[Previousorder].subtotal)+'</td>'+
             '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(response.AllOrdersCommission[Previousorder].commission)+'</td>'+
             '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">'+(response.AllOrdersCommission[Previousorder].CommissionType)+'</td>'+
             '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><a href="'+GsalesRepUrl+'/SalesRepTenant/PrintInvoicesBySalesRep?hmac='+Ghmac+'&customerName='+(response.AllOrdersCommission[Previousorder].CustomerName)+'&orderId='+response.AllOrdersCommission[Previousorder].OrderId+'&shop='+GShopName+'" target="_blank"><button type="button" id="viewOrderInvoicePrint" class="Polaris-Button Polaris-Button--primary" style="font-size:18px;padding-left: 35px;padding-right: 35px;"><span class="Polaris-Button__Content"><span>Print</span></span></button></a></td></tr>';

           items='';
           }
          }  
        $("#ViewPreviousOrderloadGif").hide();
         document.getElementById('ViewPreviousOrder').innerHTML = PreviousOrderRow;
        }
        
        //Welcome message based on system time.
        var WelcomeMsg = function()
        {
        	var date = new Date();
        	var current_hrs = date.getHours();
        	if(current_hrs < 12)
        	{
              var msg = "Good Morning {{customer.first_name }} !  Welcome to {{shop.name}}";
        	}
        	else if(current_hrs < 18)
        	{
        		var msg = "Good Afternoon {{customer.first_name }} !  Welcome to {{shop.name}}";
        	}
        	else
        	{
        		var msg = "Good Evening {{customer.first_name }} !  Welcome to {{shop.name}}";
        	}
        	return msg;
        }
        document.getElementById('welcome_msg').innerHTML = WelcomeMsg();
        
        //Clickable card headers
        var ClickCustomerInvoice = function()
        {
            $('#SR_Dashboard').hide();
            $('#SR_CustomerOrder').show();
            $('#SR_Wholesale').hide();
            $('#SR_ViewCustomerOrder').hide();
            $('#SR_Discount').hide();
            $('#SR_YourBio').hide();
            $('#SR_TeamDetails').hide();
            $('#SR_Lead').hide();
            $('#SR_Clients').hide();
            $('#SR_PreviousOrder').hide();
            $('#SR_MyOrder').hide();
        } 
        
        var ClickWholesale = function()
        {
            $('#SR_Dashboard').hide();
            $('#SR_CustomerOrder').hide();
            $('#SR_Wholesale').show();
            $('#SR_ViewCustomerOrder').hide();
            $('#SR_Discount').hide();
            $('#SR_YourBio').hide();
            $('#SR_TeamDetails').hide();
            $('#SR_Lead').hide();
            $('#SR_Clients').hide();
            $('#SR_PreviousOrder').hide();
            $('#SR_MyOrder').hide();
        }
        
         var ClickAffiliate = function()
        {
            $('#SR_Dashboard').hide();
            $('#SR_CustomerOrder').hide();
            $('#SR_Wholesale').hide();
            $('#SR_ViewCustomerOrder').show();
            $('#SR_Discount').hide();
            $('#SR_YourBio').hide();
            $('#SR_TeamDetails').hide();
            $('#SR_Lead').hide();
            $('#SR_Clients').hide();
            $('#SR_PreviousOrder').hide();
            $('#SR_MyOrder').hide();
        }
        
        var ClickDiscount = function()
        {
            $('#SR_Dashboard').hide();
            $('#SR_CustomerOrder').hide();
            $('#SR_Wholesale').hide();
            $('#SR_ViewCustomerOrder').hide();
            $('#SR_Discount').show();
            $('#SR_YourBio').hide();
            $('#SR_TeamDetails').hide();
            $('#SR_Lead').hide();
            $('#SR_Clients').hide();
            $('#SR_PreviousOrder').hide();
            $('#SR_MyOrder').hide();
        }
        
        var ClickCustomerCommission = function()
        {
            $('#SR_Dashboard').hide();
            $('#SR_CustomerOrder').hide();
            $('#SR_Wholesale').hide();
            $('#SR_ViewCustomerOrder').hide();
            $('#SR_Discount').hide();
            $('#SR_YourBio').hide();
            $('#SR_TeamDetails').hide();
            $('#SR_Lead').hide();
            $('#SR_Clients').show();
            $('#SR_PreviousOrder').hide();
            $('#SR_MyOrder').hide();
        } 
        
        var ClickTeamLeadCommission = function()
        {
            $('#SR_Dashboard').hide();
            $('#SR_CustomerOrder').hide();
            $('#SR_Wholesale').hide();
            $('#SR_ViewCustomerOrder').hide();
            $('#SR_Discount').hide();
            $('#SR_YourBio').hide();
            $('#SR_TeamDetails').show();
            $('#SR_Lead').hide();
            $('#SR_Clients').hide();
            $('#SR_PreviousOrder').hide();
            $('#SR_MyOrder').hide();
        } 
           
        var DisplayCommisionDiscount = function(response)
        {   
            var repName = response.SalesRepCommissionModel.SalesRepName == undefined || response.SalesRepCommissionModel.SalesRepName == null || response.SalesRepCommissionModel.SalesRepName == "" ? response.SingleSalesRep.SalesRepName : response.SalesRepCommissionModel.SalesRepName;

        	//Affiliate link
           if(response.CommissionDiscountOn.CommissionDiscountOn == "Product")
            {
              $("#commission_on").text("Product");
           		var row = '<tr>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Product Title</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric type" scope="col" style="height: 54px;">Commission</th></tr>';
              if(response.CommissionDiscountOn.CommissionDiscountType == "FixedDollarAmount")
              {
                for(var discount in response.CommissionandDiscountPerProduct)
           		{                 
           			row += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(response.CommissionandDiscountPerProduct[discount].ProductName)+'</td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">'+(response.moneyformat+" "+response.CommissionandDiscountPerProduct[discount].AffiliateCommission.toFixed(2))+'</td></tr>';
           		}
              }
              else
              {
                for(var discount in response.CommissionandDiscountPerProduct)
           		{                 
           			row += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(response.CommissionandDiscountPerProduct[discount].ProductName)+'</td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">'+(response.CommissionandDiscountPerProduct[discount].AffiliateCommission).toFixed(2)+"%"+'</td></tr>';
           		}
              }
           
            	document.getElementById('AffiliateCommissionTable').innerHTML = row;
            }

            if(response.CommissionDiscountOn.CommissionDiscountOn == "ProductType")
            {
              $("#commission_on").text("Product Type");
           		var row = '<tr>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Product Type</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric type" scope="col" style="height: 54px;">Commission</th></tr>';

           		for(var discount in response.CommissionandDiscountPerProductType)
           		{
           			row += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(response.CommissionandDiscountPerProductType[discount].productType)+'</td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">'+(response.CommissionandDiscountPerProductType[discount].AffiliateCommission).toFixed(2)+"%"+'</td></tr>';
           		}
           
            	document.getElementById('AffiliateCommissionTable').innerHTML = row;
            }

            if(response.CommissionDiscountOn.CommissionDiscountOn == "SalesRep")
            {              
              $("#commission_on").text("Sales Rep");
           		var row = '<tr>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">SalesRep Name</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric type" scope="col" style="height: 54px;">Commission</th></tr>';
                 
           			row += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(repName)+'</td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">'+((response.SalesRepCommissionModel.AffiliateCommission)*100).toFixed(2)+"%"+'</td></tr>';
           		
            	document.getElementById('AffiliateCommissionTable').innerHTML = row;
            }
           
          //wholesale           
          if(!response.IsNewAdminUI && response.select.wholesaleqtydiscount)
          {
            $("#discount_on").text("Quantity Based Discount");
            var row = '<tr>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Product Type</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Discount</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric type" scope="col" style="height: 54px;">Quantity</th></tr>';

            for(var discount in response.TenantWholesaleQuantityDiscount)
            {
              row += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(response.TenantWholesaleQuantityDiscount[discount].ProductType)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(response.TenantWholesaleQuantityDiscount[discount].WholesaleDiscount)+"%"+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">'+(response.TenantWholesaleQuantityDiscount[discount].Quantity)+'</td></tr>';
            }
            document.getElementById('WholesaleDiscountTable').innerHTML = row;
          }
          else if(response.IsNewAdminUI && response.select.wholesaleqtydiscount)
          {
            $("#WholesaleDiscountTableDiv").hide();
            $("#WholesaleVolumePricingData").show();
           	  var row1 = '<tr>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Product Name</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Discount</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric type" scope="col" style="height: 54px;">Quantity</th></tr>';
                            
                {%for salesTeamInfo in shop.metafields.SalesTeamQtyDiscount %}
                  {% assign QuantityBasedDiscountPerProductTable = salesTeamInfo | last %}
                  {% for product in QuantityBasedDiscountPerProductTable %}
                    row1 += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                      "<td class='Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission' style='height: 72px;'>{{ product.productTitle }}</td>"+
                      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">$ {{ product.DiscountAmt | times:100 }}</td>'+
                      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">{{ product.quantity }}</td></tr>';
                  {% endfor %}
                {% endfor %}
                document.getElementById('WholesaleQuantityBaseDiscountTable').innerHTML = row1;	
          }
          else
          {
            
            if(response.CommissionDiscountOn.CommissionDiscountOn == "Product")
            {
              $("#discount_on").text("Product");
           		var row = '<tr>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Product Title</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric type" scope="col" style="height: 54px;">Discount</th></tr>';
              if(response.CommissionDiscountOn.CommissionDiscountType=="FixedDollarAmount")
              {
                for(var discount in response.CommissionandDiscountPerProduct)
           		{
           			row += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(response.CommissionandDiscountPerProduct[discount].ProductName)+'</td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">'+(response.moneyformat+" "+response.CommissionandDiscountPerProduct[discount].WholesalePrice).toFixed(2)+'</td></tr>';
           		}
              }
              else
              {
                for(var discount in response.CommissionandDiscountPerProduct)
           		{
           			row += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(response.CommissionandDiscountPerProduct[discount].ProductName)+'</td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">'+(response.CommissionandDiscountPerProduct[discount].WholesalePrice).toFixed(2)+"%"+'</td></tr>';
           		}
              }
           
            	document.getElementById('WholesaleDiscountTable').innerHTML = row;
            }

            if(response.CommissionDiscountOn.CommissionDiscountOn == "ProductType")
            {
              $("#discount_on").text("Product Type");
           		var row = '<tr>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Product Type</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric type" scope="col" style="height: 54px;">Discount</th></tr>';

           		for(var discount in response.CommissionandDiscountPerProductType)
           		{
           			row += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(response.CommissionandDiscountPerProductType[discount].productType)+'</td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">'+(response.CommissionandDiscountPerProductType[discount].WholesaleDiscount).toFixed(2)+"%"+'</td></tr>';
           		}          
            	document.getElementById('WholesaleDiscountTable').innerHTML = row;
            }

            if(response.CommissionDiscountOn.CommissionDiscountOn == "SalesRep")
            {
              $("#discount_on").text("Sales Rep");
           		var row = '<tr>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">SalesRep Name</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric type" scope="col" style="height: 54px;">Commission</th></tr>';
                  
           			row += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(repName)+'</td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">'+((response.SalesRepCommissionModel.WholesaleDiscount)*100).toFixed(2)+"%"+'</td></tr>';
           		
            	document.getElementById('WholesaleDiscountTable').innerHTML = row;
            }
          }
           //clientInvoice commission
          if(response.select.ClientDiscount)
              {
                $("#discount_commission_on").text("Client Discount Tiers");
          		 var row = '<tr>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Product Type</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Commission</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Discount Name</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric type" scope="col" style="height: 54px;">Discount</th></tr>';

           		for(var commission in response.ClientInvoiceDiscount)
           		{
           			row += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(response.ClientInvoiceDiscount[commission].ProductType)+'</td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+((response.ClientInvoiceDiscount[commission].CommissionRate)*100).toFixed(2)+"%"+'</td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(response.ClientInvoiceDiscount[commission].DiscountName)+'</td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">'+(response.ClientInvoiceDiscount[commission].DiscountRate)*100+"%"+'</td></tr>';
           		}
                document.getElementById('ClientInvoiceCommissionTable').innerHTML = row;
              }
          else
          {          
           if(response.CommissionDiscountOn.CommissionDiscountOn == "Product")
            {
              $("#discount_commission_on").text("Product");
           		var row = '<tr>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Product Title</th>'+
              	'<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric type" scope="col" style="height: 54px;">Commission</th></tr>';
              if(response.CommissionDiscountOn.CommissionDiscountType == "FixedDollarAmount")
              {                
                    
           		for(var commission in response.CommissionandDiscountPerProduct)
           		{
           			row += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(response.CommissionandDiscountPerProduct[commission].ProductName)+'</td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">'+(response.moneyformat+" "+response.CommissionandDiscountPerProduct[commission].CommissionForCustomerOrder).toFixed(2)+'</td></tr>';
           		}
              }
              else
              {
                for(var commission in response.CommissionandDiscountPerProduct)
           		{
           			row += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(response.CommissionandDiscountPerProduct[commission].ProductName)+'</td>'+
                      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">'+(response.CommissionandDiscountPerProduct[commission].CommissionForCustomerOrder).toFixed(2)+"%"+'</td></tr>';
                     
           		}
              } 
           
            	document.getElementById('ClientInvoiceCommissionTable').innerHTML = row;
            }

            if(response.CommissionDiscountOn.CommissionDiscountOn == "ProductType")
            {              
              $("#discount_commission_on").text("Product Type");
          		 var row = '<tr>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Product Type</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric type" scope="col" style="height: 54px;">Commission</th></tr>';

           		for(var commission in response.CommissionandDiscountPerProductType)
           		{
           			row += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(response.CommissionandDiscountPerProductType[commission].productType)+'</td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">'+(response.CommissionandDiscountPerProductType[commission].ClientCommission).toFixed(2)+"%"+'</td></tr>';
           		}                        
            	document.getElementById('ClientInvoiceCommissionTable').innerHTML = row;
            }

            if(response.CommissionDiscountOn.CommissionDiscountOn == "SalesRep")
            {
              $("#discount_commission_on").text("Sales Rep");
           		var row = '<tr>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">SalesRep Name</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric type" scope="col" style="height: 54px;">Commission</th></tr>';
                  
           			row += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(repName)+'</td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">'+((response.SalesRepCommissionModel.Commissionforsalerep)*100).toFixed(2)+"%"+'</td></tr>';
           		
            	document.getElementById('ClientInvoiceCommissionTable').innerHTML = row;                
            }
          }
          if(response.select.QuantityBasedDiscountInInvoices)
          {
              $("#VolumePricingData").show();
           	  var row1 = '<tr>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Product Name</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Discount</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric type" scope="col" style="height: 54px;">Quantity</th></tr>';
                            
                {%for salesTeamInfo in shop.metafields.SalesTeamQtyDiscount %}
                  {% assign QuantityBasedDiscountPerProductTable = salesTeamInfo | last %}
                  {% for product in QuantityBasedDiscountPerProductTable %}
                    row1 += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                      "<td class='Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission' style='height: 72px;'>{{ product.productTitle }}</td>"+
                      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">$ {{ product.DiscountAmt | times:100 }}</td>'+
                      '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric type" style="height: 72px;">{{ product.quantity }}</td></tr>';
                  {% endfor %}
                {% endfor %}
                document.getElementById('ClientInvoiceQuantityBaseDiscountTable').innerHTML = row1;			 
          }
        }

		var GetCartData = function()
        {         
            var CartData = [];  
            var AffiliateProduct = [];
          	var item_count = {{cart.item_count}}
          
        	{% for line in cart.items %}
                var price = ({{line.variant.price | amount_no_decimals  }})/100;
                var total_price = ({{line.final_line_price | amount_no_decimals  }})/100;
          
          		var variant = [];
                var propertiesObj = {};
                var propertiesArr =[];
          
          		variant.push({
                  "price":price,
                  "id":'{{line.variant_id}}'
                });

                {% for property in line.properties %}
                propertiesObj['{{ property | first }}']= '{{ property | last }}'
                propertiesArr.push({
                    "name" : '{{ property | first }}',
                    "value" : '{{ property | last }}'
                    });
                {% endfor %}  
          
                CartData.push({
                "Image":'{{ line.image | product_img_url: '100x100' }}',
                "title":'{{line.title}}',
                "product_quantity":{{line.quantity}},
                "Item_Price":price.toString(),
                "product_price":total_price,
                "product_type":'{{line.product.type}}',
                "variantId":'{{line.variant_id}}',
                "product_size":"{{line.variant.option1 | escape}}",
                "handle":'{{line.product.handle}}',
                "count":{{cart.item_count}},
                "variants": variant,
                "properties" : propertiesObj,
                "propertiesArr" : propertiesArr
              });
          	{%endfor%}
          
          for(var data in CartData)
          {
            AffiliateProduct.push({
              "images": CartData[data].Image,
              "title": CartData[data].title,
              "handle": CartData[data].handle,
              "variants": CartData[data].variants,
              "price": CartData[data].Item_Price,
              "type": CartData[data].product_type
            });
          }
          
          if(item_count != 0 )
          {
          	ClientInvoiceCartData(CartData);
            WholesaleOrderCartData(CartData);
            ShowAffiliateCartProduct(serverData,CartData);
			SharedCartData(CartData);
              //ShowAffiliateProducts(AffiliateProduct,true,response.CommissionDiscountOn.CommissionDiscountOn);
          }          
        }
      
      var ShowAffiliateCartProduct = function(response,CartData)
        {
          	var CommissionDiscountOn = response.CommissionDiscountOn.CommissionDiscountOn;
        	var orderRow = '<tr>'+
             '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product </th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product Title</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Price</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Commission</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Affiliate Link</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Share Link</th></tr>';

          	if(CommissionDiscountOn=="ProductType")
            {
            	for(var product in CartData)
                   {
                             var producttype = CartData[product].product_type ;
                             if(producttype == "")
                             {
                               producttype = "all other products";
                             }
                             for(var productdata in response.AffiliateCommission)
                             {
                                if(producttype.toLowerCase() == response.AffiliateCommission[productdata].type)
                                {
                                 var currency = "{{shop.currency}}";
                                 var url = new URL(response.SingleSalesRep.SalesRepAffiliateUrl);
                                  var affiliateUrl = url.searchParams.get("ambassador");
                                 var url = "{{shop.url}}/products/"+CartData[product].handle+"/?ambassador="+affiliateUrl+"";
                                 
                                    var productprice =CartData[product].Item_Price;
                                     orderRow += '<tr class="Polaris-DataTable__TableRow">'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><img class="sr_productImage" style="width:60px;" src="'+CartData[product].Image+'"></td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+CartData[product].title+'</td>'+     
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productprice +  " " +currency+'</td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+response.AffiliateCommission[productdata].Commission+'%</td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+url+'</td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
                                    '<a href="http://pinterest.com/pin/create/bookmarklet/?is_video=false&url='+url+'" class="ssbp-btn ssbp-pinterest" rel="nofollow"  data-ssbp-url="'+url+'" data-ssbp-site="Pinterest_force" target="_blank">'+ 
                                    '<img src="https://simplesharebuttons.com/images/somacro/pinterest.png" alt="Pinterest" style="width:35px;"/></a>'+
                                    '<a href="http://instagram.com/###?ref='+url+'" class="ig-b- ig-b-32"  target="_blank"><img src="https://badges.instagram.com/static/images/ig-badge-32.png" alt="Instagram"/></a>'+
                                    '<a href="https://twitter.com/share?url='+url+'&amp;text='+shopname+'" target="_blank"><img src="https://simplesharebuttons.com/images/somacro/twitter.png" alt="Twitter" style="width:35px;"/></a>'+
                                    '<a href="http://www.facebook.com/sharer.php?u='+url+'" target="_blank"><img src="https://simplesharebuttons.com/images/somacro/facebook.png" alt="Facebook" style="width:35px;"/></a>'+                               
                                    '</td></tr>';                                                                                                                 
                                  }
                             }
                   }   
          }
          if(CommissionDiscountOn=="Product")
              {
                   for(var product in CartData)
                   {              
                                 var currency = "{{shop.currency}}";
                                 var url = new URL(response.SingleSalesRep.SalesRepAffiliateUrl);
                                  var affiliateUrl = url.searchParams.get("ambassador");
                                 var url = "{{shop.url}}/products/"+CartData[product].handle+"/?ambassador="+affiliateUrl+"";

                                 
                                   for(var productdata in response.AffiliateCommissionPerProduct)
                                   {
                                      var variantId = CartData[product].variantId;
                                       if(variantId == response.AffiliateCommissionPerProduct[productdata].variantId)                                   
                                       {
                                         var productprice =CartData[product].Item_Price;
                                         var commission=Math.round((response.AffiliateCommissionPerProduct[productdata].Commission)*100);
                                         orderRow += '<tr class="Polaris-DataTable__TableRow">'+
                                        '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><img class="sr_productImage" style="width:60px;" src="'+CartData[product].Image+'"></td>'+
                                        '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+CartData[product].title+'</td>'+     
                                        '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productprice +  " " +currency+'</td>'+
                                        '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+commission+'%</td>'+
                                        '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+url+'</td>'+
                                        '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
                                        '<a href="http://pinterest.com/pin/create/bookmarklet/?is_video=false&url='+url+'" class="ssbp-btn ssbp-pinterest" rel="nofollow"  data-ssbp-url="'+url+'" data-ssbp-site="Pinterest_force" target="_blank">'+ 
                                        '<img src="https://simplesharebuttons.com/images/somacro/pinterest.png" alt="Pinterest" style="width:35px;"/></a>'+
                                        '<a href="http://instagram.com/###?ref='+url+'" class="ig-b- ig-b-32"  target="_blank"><img src="https://badges.instagram.com/static/images/ig-badge-32.png" alt="Instagram"/></a>'+
                                        '<a href="https://twitter.com/share?url='+url+'&amp;text='+shopname+'" target="_blank"><img src="https://simplesharebuttons.com/images/somacro/twitter.png" alt="Twitter" style="width:35px;"/></a>'+
                                        '<a href="http://www.facebook.com/sharer.php?u='+url+'" target="_blank"><img src="https://simplesharebuttons.com/images/somacro/facebook.png" alt="Facebook" style="width:35px;"/></a>'+                               
                                        '</td></tr>'; 
                                       }                                                                                                                                                                                     
                                 }
                       }
              }
          if(CommissionDiscountOn=="SalesRep")
              {
                   for(var product in CartData)
                   {
                        var salesrepId = "{{customer.id}}";
                             
                             for(var productdata in response.AffiliateCommissionPerRepModel)
                             {
                                if(salesrepId == response.AffiliateCommissionPerRepModel[productdata].SalesRepId)
                                {
                                 var currency = "{{shop.currency}}";
                                  var url = new URL(response.SingleSalesRep.SalesRepAffiliateUrl);
                                  var affiliateUrl = url.searchParams.get("ambassador");
                                 var url = "{{shop.url}}/products/"+CartData[product].handle+"/?ambassador="+affiliateUrl+"";
                                 
                                    var productprice =CartData[product].Item_Price;
                                     orderRow += '<tr class="Polaris-DataTable__TableRow">'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><img class="sr_productImage" style="width:60px;" src="'+CartData[product].Image+'"></td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+CartData[product].title+'</td>'+     
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productprice +  " " +currency+'</td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+response.AffiliateCommissionPerRepModel[productdata].Commission+'%</td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+url+'</td>'+
                                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
                                    '<a href="http://pinterest.com/pin/create/bookmarklet/?is_video=false&url='+url+'" class="ssbp-btn ssbp-pinterest" rel="nofollow"  data-ssbp-url="'+url+'" data-ssbp-site="Pinterest_force" target="_blank">'+ 
                                    '<img src="https://simplesharebuttons.com/images/somacro/pinterest.png" alt="Pinterest" style="width:35px;"/></a>'+
                                    '<a href="http://instagram.com/###?ref='+url+'" class="ig-b- ig-b-32"  target="_blank"><img src="https://badges.instagram.com/static/images/ig-badge-32.png" alt="Instagram"/></a>'+
                                    '<a href="https://twitter.com/share?url='+url+'&amp;text='+shopname+'" target="_blank"><img src="https://simplesharebuttons.com/images/somacro/twitter.png" alt="Twitter" style="width:35px;"/></a>'+
                                    '<a href="http://www.facebook.com/sharer.php?u='+url+'" target="_blank"><img src="https://simplesharebuttons.com/images/somacro/facebook.png" alt="Facebook" style="width:35px;"/></a>'+                               
                                    '</td></tr>';                                                                                                                 
                                 }                               
                            }
                       }  
              }
          document.getElementById('affiliateCartProdtable').innerHTML = orderRow; 
          $('#AffiliateCartProductTable').show();
          $("#affiliateSpinner").hide();   
        }      

function fetchBaseModelData(){
var CheckInterval2=setInterval(function(){
    clearInterval(CheckInterval2);
    if (!window.jQuery || (typeof jQuery === 'undefined') || (parseFloat(jQuery.fn.jquery) < 1.7)) 
    {
      loadScript('https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js', function () {
        jQuery191 = jQuery.noConflict(true);
        jQuery = jQuery191;
		$ = jQuery191;
        LoadSRClickHandlers(jQuery191);
        GetBaseModelData(jQuery191);		
      });
    } 
    else {
      LoadSRClickHandlers(jQuery);
      GetBaseModelData(jQuery);
    }                
},100);
}
var isSRBaseDataLodaed = false;
window.onload=function(){
    isSRBaseDataLodaed = true;
    fetchBaseModelData();
}

function checkIfSRBaseDataIsLoaded(){
  if(!isSRBaseDataLodaed){
  fetchBaseModelData();
  }
}

setTimeout(function () {
checkIfSRBaseDataIsLoaded();
}, 1000);


</script>
<!--Client Invoice Script Code -->
<script>  
  //Customer Order Script
  var i=0;
  var ClientInvoiceDiscount ="";
  var ProductQuantity=0;
Clientproduct=[];
  ClientInvoiceselectedProduct=[];
  InvoiceOrders=[]; 
   var CommissionanddiscountOn="";

  function showClientInvoiceQuantityBaseDiscountTable(){
    $("#qtybaseddiscounttable").toggle(100);
  }
  
  function showWholesaleQuantityBaseDiscountTable(){
    $("#wholesaleqtybaseddiscounttable").toggle(100);
  }
  
  function minusQuantity(vid,selectedProductTable = "false")
  {
    var $input = selectedProductTable == "true" ? $('#quantity_'+vid).parent().find("input") : $('#ClientInvoicequantity_'+vid).parent().find("input");
    var count = parseInt($input.val()) - 1;
    count = count < 1 ? 1 : count;
    $input.val(count);
    $input.change();
    return false;
  }

  function plusQuantity(vid,selectedProductTable = "false")
  {
    var $input = selectedProductTable == "true" ? $('#quantity_'+vid).parent().find("input"): $('#ClientInvoicequantity_'+vid).parent().find("input");
    $input.val(parseInt($input.val()) + 1);
    $input.change();
    return false;
  }
  
  
 function bioAffiliateLink(event) {
    $('#aff_link').text(window.location.protocol +"//"+ window.location.hostname + "/" + event.target.value);
 };
  
   var createCart = function()
  {
      var sr_cartName=document.getElementById("sr_sharedcartname").value;
    if(sr_cartName == ""){
            $("#cretecart_btn").text("Create Cart");  
          $("#productnotselectforcartsharing").text('Please Enter Cart Name');
      }
      else if (selectedProduct.length < 1){
      $("#cretecart_btn").text("Create Cart");  
          $("#productnotselectforcartsharing").text('No Products Selected. Please select products and try again.');
      }
        else{
             $("#cretecart_btn").text("Wait While Processing..."); 
          myCart=[]; 
          for(var data in SharedCartProduct)
      {
            myCart.push({
              id : SharedCartProduct[data].variantId,  
              quantity : SharedCartProduct[data].product_quantity,
              properties : SharedCartProduct[data].properties,
              handle : SharedCartProduct[data].productHandle
            });
          }
              var myCartString = JSON.stringify(myCart);
            var cart = {
              "salesRepName" : "{{customer.first_name}}",
              "SalesrepId" : {{customer.id}},
                    "cartName" : sr_cartName,
                    "cartdata" : myCartString
            }
            var data = JSON.stringify(cart);
              //change the pageIndex value according to whatever latest 
            var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?pageIndex=30&data="+data;
        $.post(
               urlVal,
         function (data, status) {                 
                      if(data == true)
                            {
                 $("#cretecart_btn").text("Create Cart"); 
                               location.reload();
                            }
                      else
                 $("#cretecart_btn").text("Create Cart");
            }
          );
              }    
    }

        var ShowSharedCartProduct = function(data)
        {
          var orderRow = '<tr>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Cart Link</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Share Link</th>'+
             '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Remove Cart</th></tr>';
      
              for(var cart in data.SharedCarts)
              {
          var url = "{{shop.url}}/products/"+CartData[product].handle+"/?myCart={{customer.first_name}}{{customer.id | modulo:1000}}";
                                 
                  orderRow += '<tr class="Polaris-DataTable__TableRow">'+
                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"></td>'+
                  '<a href="http://pinterest.com/pin/create/bookmarklet/?is_video=false&url='+url+'" class="ssbp-btn ssbp-pinterest" rel="nofollow"  data-ssbp-url="'+url+'" data-ssbp-site="Pinterest_force" target="_blank">'+ 
                  '<img src="https://simplesharebuttons.com/images/somacro/pinterest.png" alt="Pinterest" style="width:35px;"/></a>'+
                  '<a href="http://instagram.com/###?ref='+url+'" class="ig-b- ig-b-32"  target="_blank"><img src="https://badges.instagram.com/static/images/ig-badge-32.png" alt="Instagram"/></a>'+
                  '<a href="https://twitter.com/share?url='+url+'&amp;text='+shopname+'" target="_blank"><img src="https://simplesharebuttons.com/images/somacro/twitter.png" alt="Twitter" style="width:35px;"/></a>'+
                  '<a href="http://www.facebook.com/sharer.php?u='+url+'" target="_blank"><img src="https://simplesharebuttons.com/images/somacro/facebook.png" alt="Facebook" style="width:35px;"/></a>'+                               
                  '</td>'+
                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
        '</tr>';  
              }
        }


  var ClientInvoiceCartData = function(CartData)
       {
         for(var data in CartData)
          {
           Clientproduct.push({
                  "Image":CartData[data].Image,
                  "title":CartData[data].title,
                  "product_quantity":CartData[data].product_quantity,
                  "Item_Price":CartData[data].Item_Price,
                  "retailPrice" :CartData[data].Item_Price,
                  "product_price":CartData[data].product_price,
                  "product_type":CartData[data].product_type,
                  "variantId":CartData[data].variantId,
                  "product_size":CartData[data].product_size,
                "properties" : CartData[data].propertiesObj,
              "propertiesArr" : CartData[data].propertiesArr
            });

              ClientInvoiceselectedProduct.push({
                "variantId" :CartData[data].variantId, 
                 "quantity" :CartData[data].product_quantity,
                 "product_type" :CartData[data].product_type,
              "propertiesArr" : CartData[data].propertiesArr
              });

              showDetailsInClientInvoiceProductTable(serverData,Clientproduct[data].Item_Price,Clientproduct[data].product_quantity,Clientproduct[data].Image,Clientproduct[data].title,Clientproduct[data].product_type,Clientproduct[data].product_size,Clientproduct[data].propertiesArr);

          }        
       }
  
  // Add selected products to the product table
   var AddProductInClientInvoice=function(title,retailPrice,image,type,Pid,size,updatestring = false,quantity = 0, wholesalePrice = ""){
    var quantity;
    var propertiesObj = {};
    var propertiesArr =[];
    var price = retailPrice;
    if(wholesalePrice != "")
    {
        price = wholesalePrice;
    }
    if(updatestring == "BeforeUpdate")
    {
     quantity =$('#ClientInvoicequantity_'+Pid).val();
    }
    else
    {
      quantity = $('#quantity_'+Pid).val();
    }
    
    if(quantity==""){
      quantity=1;
    }

if(ClientInvoiceselectedProduct.length==0){
       ClientInvoiceselectedProduct.push({
      "variantId" :Pid , 
       "quantity" :  quantity,
       "product_type" : type,
       "propertiesArr":[]
    });
}
else{
      if((ClientInvoiceselectedProductIndex = ClientInvoiceselectedProduct.findIndex((obj => obj.variantId == Pid)))>=0){
        if(updatestring == "BeforeUpdate")
        {
           ClientInvoiceselectedProduct[ClientInvoiceselectedProductIndex].quantity = parseInt(ClientInvoiceselectedProduct[ClientInvoiceselectedProductIndex].quantity)+parseInt(quantity)
        }
        else
        {
           ClientInvoiceselectedProduct[ClientInvoiceselectedProductIndex].quantity = parseInt(quantity)
        }
    }
  else{
       ClientInvoiceselectedProduct.push({
      "variantId" :Pid , 
       "quantity" :  quantity,
       "product_type" : type,
       "propertiesArr":[]
    });
  }
}

  if(Clientproduct.length==0){
     Clientproduct.push({
    "product_type":type,
    "product_price":price*quantity,
    "Item_Price":price,
    "retailPrice" :retailPrice,
    "product_quantity":quantity,
    "Image":image,
    "title":title,
    "product_size":size,
    "variantId":Pid,
       "properties" : propertiesObj,
       "propertiesArr" : propertiesArr
  });
  }
  else{
    if((ProductIndex = Clientproduct.findIndex((obj => obj.variantId == Pid)))>=0){
        if(updatestring == "BeforeUpdate")
        {
            Clientproduct[ProductIndex].product_price = Clientproduct[ProductIndex].product_price+(price*quantity)
          Clientproduct[ProductIndex].product_quantity = parseInt(Clientproduct[ProductIndex].product_quantity)+parseInt(quantity)
      }
        else
        {
            Clientproduct[ProductIndex].product_price = (price*quantity)
            Clientproduct[ProductIndex].product_quantity = parseInt(quantity)
        }
    }
    else{
    Clientproduct.push({
    "product_type":type,
    "product_price":price*quantity,
    "Item_Price":price,
    "retailPrice" :retailPrice,
    "product_quantity":quantity,
    "Image":image,
    "title":title,
    "product_size":size,
    "variantId":Pid,    
    "properties" : propertiesObj,
    "propertiesArr" : propertiesArr
  });
    }

  }
     showDetailsInClientInvoiceProductTable(serverData,price,quantity,image,title,type,size,[]);
  }
  
  var showDetailsInClientInvoiceProductTable=function(response,price,quantity,image,title,type,size,propertiesArr){
  	$(".ToTop").removeClass("hide");
    document.getElementById( 'productTable' ).scrollIntoView();
    $('#productnotselect1').hide();
    $("#Customedraft_btn").show();
     CommissionanddiscountOn = response.CommissionDiscountOn.CommissionDiscountOn;
     var val=$('#DiscountType').val();
     console.log(response.CommissionDiscountOn.CommissionDiscountOn);
   
    
    //if ClientDiscount is selected     
    if(response.select.ClientDiscount)
    {
        $("#CreateInvoice").hide();
      if(response.CommissionDiscountOn.CommissionDiscountOn == "Product") {
        ClientInvoiceDiscount = response.ClientInvoiceDiscountPerProduct;
      }
      else{
        ClientInvoiceDiscount = response.ClientInvoiceDiscount;
      }
        
        if(Clientproduct == 0)
    {
        $("#productTable").hide();
          $("#productnotselect1").text('No Products Selected. Please select products and try again.'); 
    }
        else
        {
          $('#CustomDiscount').show();
      var count = 1;
          var customersalerows = '<tr id="ClientInvoicerow">'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;"> </th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product </th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product Name</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Size</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Quantity </th>'+
            "<th data-polaris-header-cell='true' class='Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric' scope='col' style='height: 54px;'>Item Price</th>"+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Total Price</th>';
            if(serverData.PriceListFeature)
            {
             customersalerows += "<th data-polaris-header-cell='true' class='Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric' scope='col' style='height: 54px;'>Wholesale Price</th>";
            }

            customersalerows += '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Discounted Price for Customer</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;white-space: pre-wrap;">SalesRep Commission</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;white-space: pre-wrap;">DiscountType</th></tr>';
   
            for(var data in Clientproduct)
            {
              var AfterUpdate = "AfterUpdate";
              ProductQuantity=parseInt(Clientproduct[data].product_quantity);
              if(response.CommissionDiscountOn.CommissionDiscountOn == "Product") {
                var VariantId=Clientproduct[data].variantId;
                              	var k=0;
        		var optns = null ;
                var prodProperties="";
              	console.log(response.ClientInvoiceDiscountPerProduct);
        		for(var discount in response.ClientInvoiceDiscountPerProduct)
        		{
                  if(response.ClientInvoiceDiscountPerProduct[discount].VariantId == VariantId)
                  {
                optns += '<option value="'+response.ClientInvoiceDiscountPerProduct[discount].DiscountName.toString()+'" id="'+response.ClientInvoiceDiscountPerProduct[discount].DiscountRate+'">'+ response.ClientInvoiceDiscountPerProduct[discount].DiscountName.toString()+'</option>';
                k++;
                  }
        		}
                for(var i=0;i<propertiesArr.length;i++){
                  if(propertiesArr[i].value != ''){
                    prodProperties += prodProperties == "" ? propertiesArr[i].name +":"+propertiesArr[i].value : ","  + propertiesArr[i].name +":"+propertiesArr[i].value;
                  }
                  if(i == propertiesArr.length-1){
                    prodProperties = "(" + prodProperties +")";
                  }
                 }
                customersalerows += '<tr id="row' + (Clientproduct[data].variantId) +'" class = "class="Polaris-DataTable__TableRow"">'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
                  '<img class="removeIcon" src="{{ 'minusIcon.png' | asset_img_url: '50x'  }}" style="cursor: pointer;"onclick="RemoveClientInvoiceProduct('+Clientproduct[data].variantId+')"/></td>'+
                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;" id=image'+Clientproduct[data].variantId+'><img style="width:60px;" src='+(Clientproduct[data].Image)+'></center></td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;" id=Title'+Clientproduct[data].variantId+'>'+(Clientproduct[data].title)+" "+(prodProperties)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;" id=size'+Clientproduct[data].variantId+'>'+(Clientproduct[data].product_size)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><div class="number"><span style="cursor:pointer;" onclick="minusQuantity('+Clientproduct[data].variantId+',\'true\')" class="minus">-</span><input onchange="AddProductInClientInvoice(\''+ title +'\',\''+ price +'\',\''+ image +'\',\''+ type +'\',\''+Clientproduct[data].variantId+'\',\''+size+'\',\''+AfterUpdate+'\')" type="text" style="width:2.5em;text-align:center;padding: 10px 0px;" value='+Clientproduct[data].product_quantity+' id="quantity_'+Clientproduct[data].variantId+'"><span style="cursor:pointer;" onclick="plusQuantity('+Clientproduct[data].variantId+',\'true\')" class="plus">+</span></div></td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;" id=ItemPrice'+Clientproduct[data].variantId+'>'+(currencyFormat +" "+ parseFloat(Clientproduct[data].retailPrice).toFixed(2))+'</td>';
                if(serverData.PriceListFeature)
                {
                customersalerows += '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;" id=ItemPrice'+Clientproduct[data].variantId+'>'+(currencyFormat +" "+ parseFloat(Clientproduct[data].Item_Price).toFixed(2))+'</td>';
                }
                customersalerows += '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;" id=productPrice'+Clientproduct[data].variantId+'>'+(currencyFormat +" "+ parseFloat(Clientproduct[data].product_price).toFixed(2))+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;" id=Discount'+Clientproduct[data].variantId+'>No Discount</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;" id=Commission'+Clientproduct[data].variantId+'>No Commission</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><select id="discounttype_'+Clientproduct[data].variantId +'" onchange="ApplyInvoiceDiscount(this, ' + Clientproduct[data].variantId +' );" > <option value="No Discount"> No DiscountType </option>'+ optns +'</select></td></tr>';
  
              count++;
              }
              else{
                var producttype = Clientproduct[data].product_type;
                if(producttype == "" )
        		{
            		var producttype = "all other products";          
        		}
              	var k=0;
        		var optns = null ;
                var prodProperties="";
              	console.log(response.ClientInvoiceDiscount);
        		for(var discount in response.ClientInvoiceDiscount)
        		{
                  if(response.ClientInvoiceDiscount[discount].ProductType.toLowerCase() == producttype.toLowerCase())
                  {
                optns += '<option value="'+response.ClientInvoiceDiscount[discount].DiscountName.toString()+'" id="'+response.ClientInvoiceDiscount[discount].DiscountRate+'">'+ response.ClientInvoiceDiscount[discount].DiscountName.toString()+'</option>';
                k++;
                  }
        		}
                for(var i=0;i<propertiesArr.length;i++){
                  if(propertiesArr[i].value != ''){
                    prodProperties += prodProperties == "" ? propertiesArr[i].name +":"+propertiesArr[i].value : ","  + propertiesArr[i].name +":"+propertiesArr[i].value;
                  }
                  if(i == propertiesArr.length-1){
                    prodProperties = "(" + prodProperties +")";
                  }
                 }
                customersalerows += '<tr id="row' + (Clientproduct[data].variantId) +'" class = "class="Polaris-DataTable__TableRow"">'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="max-width:fit-content;height: 72px;">'+
                  '<img class="removeIcon" src="{{ 'minusIcon.png' | asset_img_url: '50x'  }}" style="cursor: pointer;"onclick="RemoveClientInvoiceProduct('+Clientproduct[data].variantId+')"/></td>'+
                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;" id=image'+Clientproduct[data].variantId+'><img style="width:60px;" src='+(Clientproduct[data].Image)+'></td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;" id=Title'+Clientproduct[data].variantId+'>'+(Clientproduct[data].title)+" "+(prodProperties)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;" id=size'+Clientproduct[data].variantId+'>'+(Clientproduct[data].product_size)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><div class="number"><span style="cursor:pointer;" onclick="minusQuantity('+Clientproduct[data].variantId+',\'true\')" class="minus">-</span><input onchange="AddProductInClientInvoice(\''+ title +'\',\''+ price +'\',\''+ image +'\',\''+ type +'\',\''+Clientproduct[data].variantId+'\',\''+size+'\',\''+AfterUpdate+'\')" type="text" style="width:2.5em;text-align:center;padding: 10px 0px;" value='+Clientproduct[data].product_quantity+' id="quantity_'+Clientproduct[data].variantId+'"><span style="cursor:pointer;" onclick="plusQuantity('+Clientproduct[data].variantId+',\'true\')" class="plus">+</span></div></td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;" id=ItemPrice'+Clientproduct[data].variantId+'>'+(currencyFormat +" "+ parseFloat(Clientproduct[data].Item_Price).toFixed(2))+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;" id=productPrice'+Clientproduct[data].variantId+'>'+(currencyFormat +" "+ parseFloat(Clientproduct[data].product_price).toFixed(2))+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;" id=Discount'+Clientproduct[data].variantId+'>No Discount</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;" id=Commission'+Clientproduct[data].variantId+'>No Commission</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><select id="discounttype_'+Clientproduct[data].variantId +'" onchange="ApplyInvoiceDiscount(this, ' + Clientproduct[data].variantId +');" > <option value="No Discount"> No DiscountType </option>'+ optns +'</select></td></tr>';
              count++;
              }
            }
            $('#productTable').show();
            document.getElementById( 'productTable' ).innerHTML = customersalerows;
            $('#productAddedMsg').text("Product Added");
            $("#productAddedMsg").show().delay(2000).fadeOut();
        }
    }
    else{
     
      if(response.CommissionDiscountOn.CommissionDiscountOn == "Product")
      {
        console.log(response.PerProductSetCommissionModel);
        getClientCommissionandDiscount(Clientproduct,response.PerProductSetCommissionModel,currencyFormat, response.CommissionDiscountOn.CommissionDiscountOn,response.CommissionDiscountOn.CommissionDiscountType);
      }
      else if(response.CommissionDiscountOn.CommissionDiscountOn == "ProductType")
      {
        console.log(response.productssetcommission);
        getClientCommissionandDiscount(Clientproduct,response.productssetcommission,currencyFormat, response.CommissionDiscountOn.CommissionDiscountOn,response.CommissionDiscountOn.CommissionDiscountType);
      }
      else if(response.CommissionDiscountOn.CommissionDiscountOn == "SalesRep")
      {
        console.log(response.PerRepCommissionModel);
        getCommissionPerRep(Clientproduct,response.PerRepCommissionModel,currencyFormat);
      }
      else if(response.CommissionDiscountOn.CommissionDiscountOn == "ProfitMargin")
      {
        console.log(response.productssetcommission);
        getClientCommissionandDiscount(Clientproduct,response.productssetcommission,currencyFormat, response.CommissionDiscountOn.CommissionDiscountOn,response.CommissionDiscountOn.CommissionDiscountType);
      }
      $("#Choice").show();
      $('#CreateInvoice').show();
      $('#productTable').show();
      $('#draft_btn').show();
    }
    
  }
  
var RemoveClientInvoiceProduct=function(Id){
  Id=Id.toString();
   $('#row'+Id).remove();
          ClientInvoiceselectedProduct=ClientInvoiceselectedProduct.filter(function(item){
          return item.variantId!==Id;
         });     
    Clientproduct = Clientproduct.filter(function(item) { 
  return item.variantId !== Id; 
});
    if(Clientproduct.length<1){
      $('#ClientInvoicerow').hide();
      $("#Customedraft_btn").hide();
    $('#draft_btn').hide();
    }
    var data = {
                "id": Id,
                "quantity": 0,
            };
      $.ajax({
        type: 'POST',
          url: '/cart/change.js',
        dataType: 'json',
         data: data,             
        });
}   
  
var showAllCustNameList = function(){
   $("#custnamelist").toggle();
}

var filterCustomerName = function(){
    var input, filter, ul, li, a, i, txtValue;
    filter = $("#sr_customer_fname").val().toLowerCase();
  if(filter != "")
    {
       $("#custnamelist").show();
    }
    else{
      $("#custnamelist").hide();
    }
    ul = document.getElementById("custnamelist");
    li = ul.getElementsByTagName("li");
    for (i = 0; i < li.length; i++) {
        a = li[i].getElementsByTagName("a")[0];
        txtValue = a.textContent || a.innerText;
        if (txtValue.toLowerCase().indexOf(filter) > -1) {
            li[i].style.display = "";
        } else {
            li[i].style.display = "none";
        }
    }
  }

 function onChangeCountryDDFromPersonalAddress()
 {
   $('#customer_state').find('option').not(':first').remove();
   var stateArray = JSON.parse($('#customer_country option:selected').attr("data-provinces"));
   var states = "";
   for(var state in stateArray)
    {
     states += '<option value="'+stateArray[state][0]+'">'+ stateArray[state][0]+ '</option>';
    }
   $('#customer_state').append(states);
 }
  
 function onChangeCountryDDFromCompanyAddress()
 {
   $('#cust_company_state').find('option').not(':first').remove();
   var stateArray = JSON.parse($('#cust_company_country option:selected').attr("data-provinces"));
   var states = "";
   for(var state in stateArray)
    {
     states += '<option value="'+stateArray[state][0]+'">'+ stateArray[state][0]+ '</option>';
    }
   $('#cust_company_state').append(states);
 }

function showSelected(custid, tags, email,customerName)
{
  event.preventDefault();
  document.getElementById('sr_customer_fname').value = customerName;
  document.getElementById('sr_customer_email').value = email == "null" ? "" : email;
  document.getElementById('sr_customer_id').value = custid;
  document.getElementById('sr_customer_tags').value = tags;
  
  $("#custnamelist").hide();
}
                     
 var onSuccessInvoice = function(response)
 {
      if(response == false)
    {
     $("#sentinvoice"+i).text("Invoice Sending Failed");
    }
      else
      {
         $("#sentinvoice"+i).text("Invoice Sent Successfully");
      }
    }
   
       
  var SendInvoice = function(orderid,shopname,emailid,i)
  {

     $("#sentinvoice"+i).text("Sending Invoice"); 
       var data = {
              "orderid" : orderid,
              "shopname" : shopname,
                    "emailid" : emailid,
              
            }
                var invoicedata = JSON.stringify(data);
                var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?pageIndex=2&data="+invoicedata;
               $.post(
                  urlVal,
                   function (data, status) {            
                             onSuccessInvoice(data, status);
                             $("#sentinvoice"+i).text("Invoice Sent Successfully");                
                      }
                                );
  }
  
                
  var DeleteInvoice = function(orderid,shopname,i)
  {
     $("#deleteinvoice"+i).text("Deleting Invoice"); 
       var data = {
              "orderid" : orderid,
              "shopname" : shopname
              
            }
                var invoicedata = JSON.stringify(data);
                var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?pageIndex=14&data="+invoicedata;
               $.post(
                  urlVal,
                   function (data, status) {  
                             if(data == false)
                {
                $("#deleteinvoice"+i).text("Delete Invoice Failed");
                }
                  else
                  {
                    $("#deleteinvoice"+i).text("Invoice deleted Successfully");
                  }               
                      }
                    );
  }

  var DeleteSharedCartLink = function(cartUniqueId,shopName,i)
  {
     $("#deletesharedcart"+i).text("Deleting Link"); 
       var data = {
              "salesRepName" : "{{customer.first_name}}",
              "SalesrepId" : {{customer.id}},
                    "cartUniqueId" : cartUniqueId
            }
                var data = JSON.stringify(data);
                var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?pageIndex=31&data="+data;
               $.post(
                  urlVal,
                   function (data, status) {            
                             if(data == false)
                              {
                                 $("#deletesharedcart"+i).text("Error in deleting link. Please try again..");
                              }
                              else
                              {
                                 $("#deletesharedcart"+i).text("Link Deleted Successfully");
                 location.reload();
                              }               
                      }
                    );
      } 
  
  var onSuccessdata = function(response)
     {
          if(response.ClientInvoiceDetails!= 0)
         { 

           var rows = '<tr>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Customer Name</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Subtotal Price</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Status</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Invoice</th></tr>';
           for(var cust in response.ClientInvoiceDetails) { 
            if(Number.isInteger(parseInt(cust)))
            {
              if(response.ClientInvoiceDetails[cust].status != "completed")
              {
                 rows += '<tr id="row' + i +'" class = "class="Polaris-DataTable__TableRow"">'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(response.ClientInvoiceDetails[cust].customername)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(response.ClientInvoiceDetails[cust].subtotalprice)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(response.ClientInvoiceDetails[cust].status)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;display:flex">'+
                '<div><div class="Polaris-ButtonGroup__Item"><button type="button" id="viewinvoice' + i + '" class="Polaris-Button Polaris-Button--primary" style="font-size:18px;padding-left: 35px;padding-right: 35px;" onclick="showModelData('+response.ClientInvoiceDetails[cust].orderid+',\'draftId\')"><span class="Polaris-Button__Content"><span>View</span></span></button></div></div>'+
                '<div><div class="Polaris-ButtonGroup__Item"><button type="button" id="sentinvoice' + i + '" class="Polaris-Button Polaris-Button--primary" style="font-size:18px;padding-left: 35px;padding-right: 35px;" onclick="SendInvoice(\'' + response.ClientInvoiceDetails[cust].orderid+ '\',\'' + response.ClientInvoiceDetails[cust].shopname + '\',\'' + response.ClientInvoiceDetails[cust].emailid + '\',\''+i+'\')"><span class="Polaris-Button__Content"><span>Send</span></span></button></div></div>' +
                '<div><div class="Polaris-ButtonGroup__Item"><button type="button" id="deleteinvoice' + i + '" class="Polaris-Button Polaris-Button--primary" style="font-size:18px;padding-left: 35px;padding-right: 35px;" onclick="DeleteInvoice(\'' + response.ClientInvoiceDetails[cust].orderid+ '\',\'' + response.ClientInvoiceDetails[cust].shopname + '\',\''+i+'\')"><span class="Polaris-Button__Content"><span>Delete</span></span></button></div></div></td></tr>';
              } 
        else
             {
               rows += '<tr id="row' + i +'" class = "class="Polaris-DataTable__TableRow"">'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(response.ClientInvoiceDetails[cust].customername)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(response.ClientInvoiceDetails[cust].subtotalprice)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(response.ClientInvoiceDetails[cust].status)+'</td>'+
         '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
               '<div><div class="Polaris-ButtonGroup__Item"><button type="button" id="viewinvoice' + i + '" class="Polaris-Button Polaris-Button--primary" style="font-size:18px;padding-left: 35px;padding-right: 35px;" onclick="onclick=showModelData('+response.ClientInvoiceDetails[cust].orderid+',\'draftId\')"><span class="Polaris-Button__Content"><span>View</span></span></button></div></div></td></tr>';
               }
               i++;
               }
             }

          $("#ViewOrders").show();
          $("#yourSalesCard").hide();
          document.getElementById( 'ViewClientOrders' ).innerHTML = rows;

         }
         else
           {
              $("#ViewOrders").show();
              $("#noclientorder").show();
           }
         };
            
  var ViewInvoiceOrders= function()
  {
    $("#yourSalesCard").show();
     if(InvoiceOrders.length==0)
     {
        var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?customerId={{customer.id}}&customerName={{customer.first_name }}&data=2";
        $.get(
            urlVal,
            function (data, status) {  
                InvoiceOrders=data;
               onSuccessdata(InvoiceOrders)
               
            });        
     }
     else     
     {
       onSuccessdata(InvoiceOrders)
     }
              
   }

    var ResponseSuccess = function (response,textStatus) {
        $("#SalesRep_order").show();
        if (response == null)
        {
          $("#SalesRep_order").text('Error during creating your order.Please contact support');
            }        
            else if (response.id){
              $("#SalesRep_order").attr('href',response.invoice_url);
                
                $("#SalesRep_order").text('Order Invoice created successfully!  Invoice has been emailed to Customer!');
                $("#SalesRep_order").show().delay(2000).fadeOut();
                Clientproduct=[];
                ClientInvoiceselectedProduct=[];
                $('#productTable').hide();
                 document.getElementById("sr_customer_email").value = "" ;
                document.getElementById("sr_customer_fname").value = "";
                document.getElementById("sr_custom_message").value = "";
                document.getElementById("sr_customer_id").value = "" ;
            }
            else {
                 $("#SalesRep_order").text('Error during creating your order.Please contact support');                   
            }    
          } 
 
 //Custom Tiers Client Invoice     
 var CustomDiscountDraftOrder = function(){
       $("#sr_customerOrder_error1").hide();
      $("#SalesRep_order").hide();
      for(var count in ClientInvoiceselectedProduct)
        {
            var type = document.getElementById("discounttype_"+ClientInvoiceselectedProduct[count].variantId);
            if(type!=null){
             var discounttype = type.options[type.selectedIndex].value;
            
          ClientInvoiceselectedProduct[count]["DiscountType"] = discounttype;
            }    
      
        }
      var prods = JSON.stringify(ClientInvoiceselectedProduct);  
    
         var sr_customer_email=document.getElementById("sr_customer_email").value;
         var sr_customer_fname=document.getElementById("sr_customer_fname").value;
         var sr_custom_message=document.getElementById("sr_custom_message").value;

         if(sr_customer_fname == "" || sr_customer_email == "")
         {
          $("#sr_customerOrder_error1").show();
         }
          else 
            {
                if(ClientInvoiceselectedProduct.length<1){
                 $("#sr_customerOrder_error1").show();
               $("#Customedraft_btn").text("Create New Invoice");
               $("#SalesRep_order").text('No Products Selected. Please select products and try again.');
                }
                else{  
        $("#Customedraft_btn").text("Creating Order...");
         
            var order = {
                "email" : "{{customer.email}}",
                "prods" : prods,
                "customerId" : {{customer.id}},
                "wholesale": "false",
                "Index": Index,
                "fnamecus" : sr_customer_fname,
                "cusemail": sr_customer_email,
                "message" : sr_custom_message,
                "completeDraftOrder": false,
                "pro":  $('#reppro').is(":checked")                    
            }
                var customerdata = JSON.stringify(order);
               var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?pageIndex=0";
                 
                $.post(
                  urlVal,
                  customerdata,
                  function (data, status) {            
                             ResponseSuccess(data, status);
                             $("#Customedraft_btn").text("Create New Invoice"); 
                      }
                    );
                }
        }
      } 


//Default Tiers Client Invoice  
    var DraftOrder = function(){ 
        $(".ToTop").addClass("hide");
        $("#sr_customerOrder_error1").hide();
        $("#SalesRep_order").hide();
         var prods = JSON.stringify(ClientInvoiceselectedProduct);
         var sr_customer_email=document.getElementById("sr_customer_email").value;
         var sr_customer_fname=document.getElementById("sr_customer_fname").value;
         var sr_custom_message=document.getElementById("sr_custom_message").value;
         sr_customer_fname = sr_customer_fname.replace(/[^\w\s]/gi, '');
         if(sr_customer_email=="")
         {
          $("#sr_customerOrder_error1").show();
         }
              else 
            {
                if(ClientInvoiceselectedProduct.length<1){
                 $("#sr_customerOrder_error1").show();
               $("#draft_btn").text("Create New Invoice");
               $("#SalesRep_order").text('No Products Selected. Please select products and try again.');   
                }
                else{
        $("#draft_btn").text("Creating Order...");

            var order = {
                "email" : "{{customer.email}}",
                "prods" : prods,
                "customerId" : {{customer.id}},
                "wholesale": "false",
                "Index": Index,
                "fnamecus" : sr_customer_fname,
                "cusemail": sr_customer_email,
                "message" : sr_custom_message,
                "completeDraftOrder": false,
                "pro":  $('#reppro').is(":checked")
            }   
                var customerdata = JSON.stringify(order);
                var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?pageIndex=0";
                $.post(
                  urlVal, 
                  customerdata,
				  function (data, status) {            
                             ResponseSuccess(data, status);
                             $("#draft_btn").text("Create New Invoice");
                      }
                    );
                }
        }
      }          
                
     var BacktoClientPage = function(){
                $("#clientorder").show();
                  $("#ViewOrders").hide();
       }        
</script>

<!--Wholesale Order Script Code -->
<script>
  selectedProduct=[];
  wholesaleProduct=[];
  SharedCartProduct=[];
  subtotal=0;
  finalDiscount=0;
  finaldiscountamount=0;
  
   var SharedCartData = function(CartData)
    {
        for(var data in CartData)
        {
          SharedCartProduct.push({
                "Image":CartData[data].Image,
                "title":CartData[data].title,
                "product_quantity":CartData[data].product_quantity,
                "Item_Price":CartData[data].Item_Price,
                "product_price":CartData[data].product_price,
                "product_type":CartData[data].product_type,
                "variantId":CartData[data].variantId,
                "product_size":CartData[data].product_size,
            	"productHandle" : CartData[data].handle
          });
          
          selectedProduct.push({
            "variantId" :CartData[data].variantId, 
             "quantity" :CartData[data].product_quantity,
             "product_type" :CartData[data].product_type
          });
          
          subtotal=subtotal+SharedCartProduct[data].Item_Price*SharedCartProduct[data].product_quantity;
        showDetailsInSharedCartProductTable(serverData,SharedCartProduct[data].Item_Price,SharedCartProduct[data].product_quantity,SharedCartProduct[data].Image,SharedCartProduct[data].title,SharedCartProduct[data].product_type,SharedCartProduct[data].product_size,SharedCartProduct[data].variantId);
        }
    }

   var WholesaleOrderCartData = function(CartData)
    {
        for(var data in CartData)
        {
          wholesaleProduct.push({
                "Image":CartData[data].Image,
                "title":CartData[data].title,
                "product_quantity":CartData[data].product_quantity,
                "Item_Price":CartData[data].Item_Price,
                "product_price":CartData[data].product_price,
                "product_type":CartData[data].product_type,
                "variantId":CartData[data].variantId,
                "product_size":CartData[data].product_size
          });
          
          selectedProduct.push({
            "variantId" :CartData[data].variantId, 
             "quantity" :CartData[data].product_quantity,
             "product_type" :CartData[data].product_type
          });
          
          subtotal=subtotal+wholesaleProduct[data].Item_Price*wholesaleProduct[data].product_quantity;
        showDetailsInProductTable(serverData,wholesaleProduct[data].Item_Price,wholesaleProduct[data].product_quantity,wholesaleProduct[data].Image,wholesaleProduct[data].title,wholesaleProduct[data].product_type,wholesaleProduct[data].product_size,wholesaleProduct[data].variantId);

        }
    }

  // Add selected products to the product table
  var AddProductToSharedCart=function(title,price,image,type,Pid,size){
    
     var quantity=$('#quantity_'+Pid).val();
    if(quantity==""){
      quantity=1;
    }
      
     $('#SharedCarttable').hide();
    
if(selectedProduct.length==0){
      selectedProduct.push({
      "variantId" :Pid , 
       "quantity" :  quantity,
       "product_type" : type
   });
}

else{
      if((selectedProductIndex = selectedProduct.findIndex((obj => obj.variantId == Pid)))>=0){
        selectedProduct[selectedProductIndex].quantity = parseInt(selectedProduct[selectedProductIndex].quantity)+parseInt(quantity)
    }
  else{
      selectedProduct.push({
      "variantId" :Pid , 
      "quantity" :  quantity,
      "product_type" : type
    });
  }
}

  if(SharedCartProduct.length==0){
     SharedCartProduct.push({
    "product_type":type,
    "product_price":price*quantity,
    "Item_Price":price,
    "product_quantity":quantity,
    "Image":image,
    "title":title,
    "product_size":size,
    "variantId":Pid
  });
  }
  else{
    if((ProductIndex = SharedCartProduct.findIndex((obj => obj.variantId == Pid)))>=0){
        SharedCartProduct[ProductIndex].product_price = SharedCartProduct[ProductIndex].product_price+(price*quantity)
        SharedCartProduct[ProductIndex].product_quantity = parseInt(SharedCartProduct[ProductIndex].product_quantity)+parseInt(quantity)
    }
    else{
      SharedCartProduct.push({
        "product_type":type,
        "product_price":price*quantity,
        "Item_Price":price,
        "product_quantity":quantity,
        "Image":image,
        "title":title,
        "product_size":size,
        "variantId":Pid
      });
    }

  }
  subtotal=subtotal+price*quantity;
  showDetailsInSharedCartProductTable(serverData,price,quantity,image,title,type,size,Pid);
  addItems(Pid,quantity);
}

  // Add selected products to the product table
  var AddProduct=function(title,price,image,type,Pid,size){
    
     var quantity=$('#quantity_'+Pid).val();
    if(quantity==""){
      quantity=1;
    }
      
    $('#wholesaleinvoicetable').hide();
 
if(selectedProduct.length==0){
      selectedProduct.push({
      "variantId" :Pid , 
       "quantity" :  quantity,
       "product_type" : type
    });
}

else{
      if((selectedProductIndex = selectedProduct.findIndex((obj => obj.variantId == Pid)))>=0){
        selectedProduct[selectedProductIndex].quantity = parseInt(selectedProduct[selectedProductIndex].quantity)+parseInt(quantity)
    }
  else{
      selectedProduct.push({
      "variantId" :Pid , 
      "quantity" :  quantity,
      "product_type" : type
    });
  }
}

  if(wholesaleProduct.length==0){
     wholesaleProduct.push({
    "product_type":type,
    "product_price":price*quantity,
    "Item_Price":price,
    "product_quantity":quantity,
    "Image":image,
    "title":title,
    "product_size":size,
    "variantId":Pid
  });
  }
  else{
    if((ProductIndex = wholesaleProduct.findIndex((obj => obj.variantId == Pid)))>=0){
        wholesaleProduct[ProductIndex].product_price = wholesaleProduct[ProductIndex].product_price+(price*quantity)
        wholesaleProduct[ProductIndex].product_quantity = parseInt(wholesaleProduct[ProductIndex].product_quantity)+parseInt(quantity)
    }
    else{
    wholesaleProduct.push({
    "product_type":type,
    "product_price":price*quantity,
    "Item_Price":price,
    "product_quantity":quantity,
    "Image":image,
    "title":title,
    "product_size":size,
    "variantId":Pid
  });
    }

  }
  subtotal=subtotal+price*quantity;
  showDetailsInProductTable(serverData,price,quantity,image,title,type,size,Pid);
  addItems(Pid,quantity);

}
  
   var showDetailsInSharedCartProductTable=function(response,price,quantity,image,title,type,size,Pid){
    $('#productnotselectforcartsharing').hide();

    if(SharedCartProduct == 0)
  {
     $("#sharedProdTable").hide();
      $("#productnotselectforcartsharing").text('No Products Selected. Please select products and try again.');
  }
  else
  { 
       var cartrows = '<tr id="SharedCartOrderrow">'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;"> </th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product Name</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Size</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Quantity </th>'+
            "<th data-polaris-header-cell='true' class='Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric' scope='col' style='height: 54px;'>Item Price</th>"+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Total Price</th></tr>';
     for(var data in SharedCartProduct)
      {
                cartrows += '<tr id="SCrow' + (SharedCartProduct[data].variantId) +'" class = "class="Polaris-DataTable__TableRow"">'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
                  '<img class="removeIcon" src="{{ 'minusIcon.png' | asset_img_url: '50x'  }}" style="cursor: pointer;"onclick="RemoveProductFromSharedCart('+SharedCartProduct[data].variantId+','+SharedCartProduct[data].product_price+','+')"/></td>'+
                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><img style="width:60px;" src='+SharedCartProduct[data].Image+'></td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(SharedCartProduct[data].title)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(SharedCartProduct[data].product_size)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(SharedCartProduct[data].product_quantity)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(currencyFormat +" "+ SharedCartProduct[data].Item_Price)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(currencyFormat +" "+ SharedCartProduct[data].product_price)+'</td></tr>';
          }
     document.getElementById( 'sharedProdTable' ).innerHTML = cartrows;
    $('#SharedCarttable').hide();
      $('#sharedProdTable').show(); 
    }
}

  var showDetailsInProductTable=function(response,price,quantity,image,title,type,size,Pid){
    finaldiscountamount=0;
    $('#productnotselect').hide();
    $('#draftWholesale_btn').show();
    $('#totalPrice').show();
    $('#DiscountedPrice').show();
    if(serverData.IsNewAdminUI == "false" && response.select.wholesaleqtydiscount)
    {
      console.log(response.productssetcommission);
        getQuantityBasedWholesaleDiscount(wholesaleProduct,response.productssetdiscount,currencyFormat,response.select.wholesaleqtydiscount,response.CommissionDiscountOn.CommissionDiscountOn,response.CommissionDiscountOn.CommissionDiscountType,response.quantitybaseddiscountperproduct);
    }
    else
    {
      if(response.CommissionDiscountOn.CommissionDiscountOn == "Product")
      {
        getWholesaleDiscount(wholesaleProduct,response.WholesaleDiscountPerProduct,currencyFormat,response.select.wholesaleqtydiscount,response.CommissionDiscountOn.CommissionDiscountOn,response.CommissionDiscountOn.CommissionDiscountType);
      }
      
      if(response.CommissionDiscountOn.CommissionDiscountOn == "ProductType")
      {
        getWholesaleDiscount(wholesaleProduct,response.productssetdiscount,currencyFormat,response.select.wholesaleqtydiscount,response.CommissionDiscountOn.CommissionDiscountOn,response.CommissionDiscountOn.CommissionDiscountType);
      }
     
      if(response.CommissionDiscountOn.CommissionDiscountOn == "SalesRep")
      {
        getWholesaleDiscount(wholesaleProduct,response.SalesRepCommissionModel,currencyFormat,response.select.wholesaleqtydiscount,response.CommissionDiscountOn.CommissionDiscountOn,response.CommissionDiscountOn.CommissionDiscountType);
      }
    }
     

    if(wholesaleProduct == 0)
  {
     $("#prodTable").hide();
      $("#productnotselect").text('No Products Selected. Please select products and try again.');
  }
  else
  { 
       var wholesalerows = '<tr id="WholesaleOrderrow">'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;"> </th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product </th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product Name</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Size</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Quantity </th>'+
            "<th data-polaris-header-cell='true' class='Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric' scope='col' style='height: 54px;'>Item Price</th>"+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Total Price</th>'+
        '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Your Discounted Price</th></tr>';
     for(var data in wholesaleProduct)
      {
      var discountText="";
      if(wholesaleProduct[data].Discounted_Amount>0){
        discountText=currencyFormat+" "+(wholesaleProduct[data].Discounted_Amount);
        finaldiscountamount = finaldiscountamount + wholesaleProduct[data].product_price -wholesaleProduct[data].Discounted_Amount;          
      }
      else{
         wholesaleProduct[data].Discounted_Amount = wholesaleProduct[data].product_price;
         discountText="No Discount";
         finaldiscountamount = finaldiscountamount + wholesaleProduct[data].product_price -wholesaleProduct[data].product_price;        
      }

                wholesalerows += '<tr id="WOrow' + (wholesaleProduct[data].variantId) +'" class = "class="Polaris-DataTable__TableRow"">'+
                 '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
                  '<img class="removeIcon" src="{{ 'minusIcon.png' | asset_img_url: '50x'  }}" style="cursor: pointer;"onclick="RemoveProduct('+wholesaleProduct[data].variantId+','+wholesaleProduct[data].product_price+','+parseFloat(wholesaleProduct[data].Discounted_Amount)+')"/></td>'+
                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><img style="width:60px;" src='+wholesaleProduct[data].Image+'></td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(wholesaleProduct[data].title)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(wholesaleProduct[data].product_size)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(wholesaleProduct[data].product_quantity)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(currencyFormat +" "+ wholesaleProduct[data].Item_Price)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(currencyFormat +" "+ wholesaleProduct[data].product_price)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(discountText)+'</td></tr>';
          }
     document.getElementById( 'prodTable' ).innerHTML = wholesalerows;
    $('#wholesaleinvoicetable').hide();
      $('#prodTable').show(); 
    }
}
  
  var RemoveProductFromSharedCart=function(Id,totalPrice){
        Id=Id.toString();
        subtotal=subtotal-totalPrice;
       $('#totalPrice').html('Total Price: '+"<b>"+currencyFormat+"</b>"+" "+"<b>"+ subtotal.toFixed(2)+"</b>");

       $('#SCrow'+Id).remove();
         
         selectedProduct=selectedProduct.filter(function(item){
              return item.variantId!==Id;
             });
        SharedCartProduct = SharedCartProduct.filter(function(item) { 
      return item.variantId !== Id; 
    });
        if(SharedCartProduct.length<1){
          $('#SharedCartProductOrderrow').hide();
        }
        var data = {
                    "id": Id,
                    "quantity": 0,
                };
          $.ajax({
            type: 'POST',
              url: '/cart/change.js',
            dataType: 'json',
             data: data,             
            });
    }

var RemoveProduct=function(Id,totalPrice,discountAmt){
    Id=Id.toString();
    subtotal=subtotal-totalPrice;
    globalTotalDiscountAmt=globalTotalDiscountAmt-discountAmt;
  


  finalDiscount=subtotal-parseFloat(globalTotalDiscountAmt);
  finaldiscountamount=finalDiscount;
   $('#totalPrice').html('Total Price: '+"<b>"+currencyFormat+"</b>"+" "+"<b>"+ subtotal.toFixed(2)+"</b>");
var yourDiscount =  (finalDiscount == 0) ? "<b>No Discount</b>" : ("<b>"+currencyFormat+" " + (subtotal- finalDiscount).toFixed(2)+"</b>");
     $('#DiscountedPrice').html('Your Discounted Price: '+ yourDiscount +"</b>"); 
  
   $('#WOrow'+Id).remove();
         
     selectedProduct=selectedProduct.filter(function(item){
          return item.variantId!==Id;
         });
    wholesaleProduct = wholesaleProduct.filter(function(item) { 
  return item.variantId !== Id; 
});
    if(wholesaleProduct.length<1){
      $('#WholesaleOrderrow').hide();
      $('#totalPrice').hide();
      $('#DiscountedPrice').hide();
      $('#draftWholesale_btn').hide();
    }
    var data = {
                "id": Id,
                "quantity": 0,
            };
      $.ajax({
        type: 'POST',
          url: '/cart/change.js',
        dataType: 'json',
         data: data,             
        });
}   
  

function addItems(Id,quantity){  
  var data = {
                "id": Id,
                "quantity": quantity,
            };
      $.ajax({
        type: 'POST',
          url: '/cart/add.js',
        dataType: 'json',
         data: data,             
        });
  
  };  
  
    
var onSuccessWholesale = function (response,textStatus) {
   document.location.href = '/checkout?discount='+response;
       
};
    
    var DraftWholesaleOrder=function(){

        var prods = JSON.stringify(selectedProduct);
         
      if (selectedProduct.length < 1){
      $("#draftWholesale_btn").text("Create New Invoice");  
          $("#SalesRepWholesale_order").text('No Products Selected. Please select products and try again.');
      }
        else{
             $("#draftWholesale_btn").text("Wait While Processing..."); 
          if(finaldiscountamount==subtotal){
            finaldiscountamount=0;
          }
            var order = {
              "email" : "{{customer.email}}",
              "customerId" : {{customer.id}},
              "wholesale": "true",
              "Index": 5,
                    "discountAmount":finaldiscountamount,
            }
            var data = JSON.stringify(order);
            var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?pageIndex=5&data="+data;
        $.post(
               urlVal,
         function (data, status) {                 
                 onSuccessWholesale(data, status);
            }
          );
              }    
                  
      }     
</script>

<!--Discount Coupon Order Script Code -->
<script>

    var CreateCoupon = function()
  {
        var discount=document.getElementById("Discount").value;
      var coupon = document.getElementById("DiscountCouponCode").value;
    var strUser;

    if(discount == "" || coupon == "")
    {
      $("#sr_coupon_error1").show();
    }
    else
    {
    {% if customer %}
      strUser = {{customer.id}};
    {% else %}
      strUser = "";
    {% endif %}
          
        $("#submit").text("Creating Coupon..");
        var data = {
                  "couponCode" : coupon,
                "salesrepId" : strUser,
                "Discount" : discount,
              }
        var couponeData = JSON.stringify(data);
        var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?pageIndex=3&data="+couponeData;
        $.post(
        urlVal,
        function (data, status) {     
                if (data == null)
                  {
                      $("#couponempty").text(data);
                  }
                  else {
                        if(data == "Coupon Created")
                        {
               $("#couponempty").hide();
                           $("#submit").text("Coupon Created");              
                        }
                        else
                        {
                           $("#couponempty").text(data);
                        }
                      
              }
                  
        }
        );
    }
    }

var DeleteCoupon = function(coupon,couponid,i)
  {
     $("#deletecoupon"+i).text("Deleting Coupon"); 
       var data = {
              "coupon" : coupon,
              "customerId" : {{customer.id}},
                    "couponid" : couponid,
              
            }
                var data = JSON.stringify(data);
                var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?pageIndex=4&data="+data;
               $.post(
                  urlVal,
                   function (data, status) {            
                             if(data == false)
                              {
                                 $("#deletecoupon"+i).text("Coupon deleting Failed");
                              }
                              else
                              {
                                 $("#deletecoupon"+i).text("Coupon Deleted");
                              }               
                      }
                    );
      }        
          
         
      var onSuccessCoupondata = function (response, textStatus)
        {
        console.log(response.Coupons);
        if(response.Coupons == 0)
      {
            $("#Discount_Coupon").hide();
            $("#salesrepcoupon").hide();
            $("#View_DiscountCoupons").show();
          $("#OneTimeCoupons").hide();
          $("#nodiscountcoupon").show();
      }
      else{
         var DiscountCoupons = '<tr>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Coupon Code</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Coupon Discount</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Delete Coupon Code</th></tr>';
           for(var coupon in response.Coupons)
           {  
                DiscountCoupons += '<tr id="row' + i +'" class = "class="Polaris-DataTable__TableRow"">'+                
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(response.Coupons[coupon].CouponeCode)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ response.Coupons[coupon].Discount +"%"+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
                '<div><div class="Polaris-ButtonGroup__Item"><button type="button" id="deletecoupon' + i + '" class="Polaris-Button Polaris-Button--primary" style="font-size:18px;padding-left: 35px;padding-right: 35px;" onclick="DeleteCoupon(\'' + response.Coupons[coupon].CouponeCode+ '\',\''+response.Coupons[coupon].couponId+'\',\''+i+'\')"><span class="Polaris-Button__Content"><span>Delete</span></span></button></div></div></td></tr>';
             i++;
           }
      
         $("#salesrepcoupon").hide();
         $("#Discount_Coupon").hide();
         $("#View_DiscountCoupons").show();
          
        document.getElementById('OneTimeCoupons').innerHTML = DiscountCoupons;
      }
        }
        
  function myFunction() {
      var copyText = document.getElementById("myInput");
      copyText.select();
      document.execCommand("Copy");
      $('#btnmsg').text('Copied');
 
  }
       var ShowCouponTable = function ()
        {
        
        $("#Coupon_btn").text("Getting...");       
        var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?customerId={{customer.id}}&customerName={{customer.first_name }}&data=8";
               $.get(
                  urlVal,
                   function (data, status) {  
                          onSuccessCoupondata(data, status)
                          $("#Coupon_btn").text("View Coupons");
                               
                  });
        }
        
   var BacktoCouponPage = function(){
    $("#Discount_Coupon").show();
      $("#salesrepcoupon").show();
    $("#View_DiscountCoupons").hide();
   }
</script>

<!--Affiliate Orders Script Code -->
<script>
 AffiliateOrders=[];
   var onSuccessAffiliatedata = function(response)
   {
     var i;    
    
     if(response.CustomerDetails!= 0)
       { 
         var rows = '<tr>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Customer Name </th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Customer Email  </th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product Title </th>'+
      '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Order Date </th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Subtotal  </th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Commission </th></tr>';
           for(var cust in response.CustomerDetails)
           {  
              var OrderDate = new Date(parseInt(response.CustomerDetails[cust].OrderDate.replace('/Date(', '')));
                rows += '<tr id="row' + i +'" class = "class="Polaris-DataTable__TableRow"">'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(response.CustomerDetails[cust].CustomerName)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(response.CustomerDetails[cust].CustomerEmailId)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(response.CustomerDetails[cust].ProductTitle)+'</td>'+
          '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(OrderDate.toLocaleDateString())+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(response.CustomerDetails[cust].SubTotal)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(response.CustomerDetails[cust].TotalCommission)+'</td></tr>';
             i++;
           }                     
              $("#affiliateorder").hide();
              $("#View_AffiliateOrders").show();
              document.getElementById( 'AffiliateOrders' ).innerHTML = rows;
      }
    else
       {
          $("#View_AffiliateOrders").show();
          $("#noaffiliateorder").show();
      $("#affiliateorder").hide();
       }
     };
        
  
  var ViewAffiliateOrders= function(){
     $("#AffiliateOrder_btn").text("Getting..."); 
    if(AffiliateOrders.length==0)
    {
      var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?customerId={{customer.id}}&customerName={{customer.first_name }}&data=3";
               $.get(
                  urlVal,
                   function (data, status) { 
                          AffiliateOrders=data;
                          onSuccessAffiliatedata(AffiliateOrders)
                          $("#AffiliateOrder_btn").text("View Affiliate Orders");
                               
                  });
    }
      else
      {
         onSuccessAffiliatedata(AffiliateOrders)
         $("#AffiliateOrder_btn").text("View Affiliate Orders");
      }
     
     }

   var BacktoAffiliatePage = function(){
    $("#affiliateorder").show();
    $("#View_AffiliateOrders").hide();
   }
</script>

<!--Your Bio Script Code -->
<script>
 var onSuccess = function(response)
    {
      if(response == false)
    {
         $("#error_link").show();
        $("#Linksuccessmsg").hide();
     $("#save_btn").text("Save");
    }
      else
      {
       $("#error_link").hide();
        $("#Linksuccessmsg").show();
        $("#save_btn").text("Save");
      }
    }

var uploadProfilePic = function () {
        $('#upload_btn').text("Uploading...");
        var postedFile = $('#profilePicFile')[0].files[0];
        let fileData = new FormData();
        fileData.append("postedFile", postedFile);

        var strUser;
        {% if customer %}
        strUser = {{ customer.id }};
        {% else %}
        strUser = "";
        {% endif %}

    var user = {
        "repId": strUser
    }

    var data = JSON.stringify(user);
    var urlVal = window.location.protocol + "//" + window.location.hostname + "/apps/SalesRep?pageIndex=28&data=" + data;
    console.log(urlVal);

    $.ajax({
        url: urlVal,
        type: "POST",
        contentType: false,
        processData: false,
        data: fileData,
        success: function (data, status) {
            $('#upload_btn').text("Uploaded");
            location.reload();
        },
        error: function (err) {
            $('#upload_btn').text("Sorry, Try Again");
        }
    }); 
} 

var SaveBio = function()
{
    $("#save_btn").text("Saving..");
    var bio = document.getElementById("repbio").value;
  var uniquelink = document.getElementById("uniquelink").value;
    var repbio = {            
              "bio" : bio,
              "repId" : {{customer.id}},
          "repname" : "{{customer.first_name}}",
          "uniquelink" : uniquelink
             }

           var customerdata = JSON.stringify(repbio);
           var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?pageIndex=8&data="+customerdata;
        
               $.post(
                  urlVal,
                   function (data, status) {            
                             onSuccess(data, status);             
                      }
                    );
    }            
  
</script>

<!--Team Script Code -->
<script>

var onSuccessTeamMemberData = function(AllOrdersCommission)
{
    $("#teamdata").show();
  $('#TeamOrderloadGif').hide();
  //Client Order
   var teamrows = "";
 var items='';
  
  for(var RepOrder in AllOrdersCommission)
  {
     if(AllOrdersCommission[RepOrder].ProductTitle !=null)
   {
       var products =AllOrdersCommission[RepOrder].ProductTitle.split(",");
     }
    items='';
    for(var item in products)
    {
      if(products[item]!= "")
      {
        items+='<li>'+products[item]+'</li>'
      }
    }
    teamrows += '<tr class="Polaris-DataTable__TableRow">'+                
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(AllOrdersCommission[RepOrder].orderNumber)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(AllOrdersCommission[RepOrder].orderDate)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ (AllOrdersCommission[RepOrder].CustomerName)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ (AllOrdersCommission[RepOrder].SalesRepName)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ (AllOrdersCommission[RepOrder].subtotal)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ (AllOrdersCommission[RepOrder].commission)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ (AllOrdersCommission[RepOrder].TeamManagerCommission)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ (AllOrdersCommission[RepOrder].CommissionType)+'</td>'+
                '</tr>'; }
   
  $("#TeamManagerOrders").show();
   $("#ViewPreviousOrderloadGif").hide();
  $("#ClientOrderTeamMember").show();
  return teamrows;
}


function showTeamDetails(thisrep)
{
  $('#TeamOrderloadGif').show();
  $("#TeamManagerOrders").hide();

  $('#TeamManagerOrders').find('tr').not(':first').remove();
  var RepName = thisrep.options[thisrep.selectedIndex].text;
  var Repid = thisrep.options[thisrep.selectedIndex].id;

    var isAvailableTeamManagerOrders = false;
    for(var RepOrders in TeamManagerOrders)
    {	
        var Orders = TeamManagerOrders[RepOrders];
        for(var order in Orders)
        {	
		    if(Orders[order].SalesRepId == Repid)
            {
                isAvailableTeamManagerOrders = true;
			    $('#TeamManagerOrders').append(onSuccessTeamMemberData(Orders)); 
            }
            break;
        }
    }
    
    if(!isAvailableTeamManagerOrders)
    {
        var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?customerId="+Repid+"&customerName="+RepName+"&data=18";
        $.get(
        urlVal,
        function (data, status) {  
            $('#TeamManagerOrders').append(onSuccessTeamMemberData(data.AllOrdersCommission)); 
            if(data.AllOrdersCommission.length > 0)
            {
                TeamManagerOrders.push(data.AllOrdersCommission); 
            }
        }); 
    }

}
</script>

<!-- Team Lead -->
<script>

    var CreateLead = function()
  {
   $("#leadsave").text("Save"); 
      $("#LeadErrror").hide();
      $("#Leadsuccessmsg").hide();
      $("#AddCustomerErrror").text("");
        var firstname=document.getElementById("customer_fname").value;
      var lastname = document.getElementById("customer_lname").value;
        //var phoneno=document.getElementById("customer_phoneno").value;
      var email = document.getElementById("customer_email").value;
        var note=document.getElementById("customer_note").value;
      var address = document.getElementById("customer_address").value;
        var customercity=document.getElementById("customer_city").value;
        var customerstate=document.getElementById("customer_state").value;
         var customercountry=$("#customer_country option:selected").val();
        var customerpincode=document.getElementById("customer_pincode").value;
        var business_name=document.getElementById("business_name").value;
        var companyaddress=document.getElementById("cust_company_address").value;
        var companycity=document.getElementById("cust_company_city").value;
        var companystate=document.getElementById("cust_company_state").value;
        var companycountry=$("#cust_company_country option:selected").val();
        var companypincode=document.getElementById("cust_company_pincode").value;
      
    var salesrepid, salesrepname;

      if(firstname==""||email==""){
        $('#AddCustomerErrror').html("Please fill the required field.");
     }
      else
      {
        {% if customer %}
      salesrepid = {{customer.id}};
      salesrepname = "{{customer.first_name}}";
    {% else %}
      strUser = "";
    {% endif %}
          
        $("#leadsave").text("Saving..");
        var data = {
                "SalesRepId" : salesrepid,
        "SalesRepName" : salesrepname,    
                "firstname" : firstname, 
                "lastname" : lastname,
                //"phoneno" : phoneno,
                "email" : email,
                "note" : note,
                "address" : address,
                "customercity" : customercity,
                "customerstate" : customerstate,
                "customercountry": customercountry,
                "customerpincode" : customerpincode,
                "companyaddress" : companyaddress,
                "companycity" : companycity,
                "companystate" : companystate,
                "companycountry" : companycountry,
                "companypincode" : companypincode,
                "business_name":business_name,
    
         }
        var leadData = JSON.stringify(data);
        var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?pageIndex=13";
         $.ajax({
           url : urlVal,
           type : "post",
           data: leadData,
           dataType: "json",
           async : false,
           success :function (data, status) {     
                    if(data == "This customer is already tagged to a rep.")
                      {        
                        $("#Leadsuccessmsg").hide();
                        $("#leadsave").text("Save"); 
                        $("#LeadErrror").show();
                      }
                      else if(data == "Customer sucessfully tagged to a rep.")
                      {
                       $("#LeadErrror").hide();
                        $("#leadsave").text("Save"); 
                        $("#Leadsuccessmsg").show();
                        $("#customer_fname").val("");
                        $("#customer_lname").val("");
                        $("#customer_email").val("");
                        $("#customer_note").val("");
                        $("#customer_address").val("");
                        $("#customer_city").val("");
                        $("#customer_state").find('option').not(':first').remove();
                        $("#customer_pincode").val("");
                        $("#business_name").val("");
                        $("#cust_company_address").val("");
                        $("#cust_company_city").val("");
                        $("#cust_company_country").val("");
                        $("#cust_company_state").find('option').not(':first').remove();
                      }
                      else
                      {
                        $("#Leadsuccessmsg").hide();
                        $("#leadsave").text("Save"); 
                        $("#LeadErrror").hide();
                        $("#AddCustomerErrror").html(data);
                      }                 
                  }
        });
      }
    }
</script>

<!--Your Clients Code-->
<script>
  ClientOrders=[];
var onSuccessClientOrdersData = function(response,Clientid)
{
   console.log(response.clientallorders);
  for(var data in response)
  {
    if(response[data].data.clientallorders != 0 && response[data].clientId==Clientid)
       { 
        
         var rows = '<tr>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Order Number </th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Order Date</th>'+
      '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Subtotal</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Status</th>'+
        '<th colspan="3" data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product Details</th></tr>';
     var items='';
         var quantity='';
         var price='';
         for(var order in response[data].data.clientallorders)
           { 
          items='';
              quantity='';
              price='';
             items+='<li><b>Product Title</b></li>';
             quantity+='<b><li>Quantity</b></li>';
             price+='<b><li>Price</b></li>';
             
             for(var item in response[data].data.clientallorders[order].lineitems)
             {
               if(response[data].data.clientallorders[order].lineitems[item].title!= "")
                {
                  items+='<li>'+response[data].data.clientallorders[order].lineitems[item].title+'</li>'
                  quantity+='<li>'+response[data].data.clientallorders[order].lineitems[item].quantity+'</li>'
                  price+='<li>'+response[data].data.clientallorders[order].lineitems[item].price+'</li>'
                }
             }
              var orderDate = new Date(parseInt(response[data].data.clientallorders[order].created_at.replace('/Date(', '')));
                rows += '<tr id="row' + i +'" class = "class="Polaris-DataTable__TableRow"">'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(response[data].data.clientallorders[order].order_number)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(orderDate.toLocaleDateString())+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(response[data].data.clientallorders[order].subtotal_price.toFixed(2))+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(response[data].data.clientallorders[order].financial_status)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><ul>'+items+'</ul></td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><ul>'+quantity+'</ul></td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><ul>'+price+'</ul></td></tr>';
             
           }        
              $("#norepclientorder").hide();
              $("#Clientdetails").hide();
              $("#ViewRepClientOrders").show();
              $("#ViewRepClientOrdersDetails").show();
              document.getElementById( 'ViewRepClientOrdersDetails' ).innerHTML = rows;
           break;
       }
    else
       {     
          $("#Clientdetails").hide();
          $("#ViewRepClientOrders").show();
          $("#norepclientorder").show();
      $("#ViewRepClientOrdersDetails").hide();       
       }
    
  }
    
  
}

var ClientOrdersDetails = function(Clientid,ClientName)
{  
  if(ClientOrders.length==0)
  {
    var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?customerId="+Clientid+"&customerName="+ClientName+"&data=12";
    $.get(
          urlVal,
          function (data, status) {  
            ClientOrders.push({
                "clientId" :Clientid , 
                "data" :  data,
            });
          onSuccessClientOrdersData(ClientOrders,Clientid)         
     });
  }
  else if(ClientOrders.length>0)
  {
    if(ClientOrders.find(x => x.clientId === Clientid))
    {
          onSuccessClientOrdersData(ClientOrders,Clientid)   
    }
    else
    {
      var urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?customerId="+Clientid+"&customerName="+ClientName+"&data=12";
          $.get(
            urlVal,
            function (data, status) {  
            ClientOrders.push({
                "clientId" :Clientid , 
                "data" :  data,
            });
          onSuccessClientOrdersData(ClientOrders,Clientid)         
        });
      
    }
  }                              
}

var BacktoYourClientPage = function(){
                $("#Clientdetails").show();
                  $("#ViewRepClientOrders").hide();
       }


    
var onSuccessOrderProducts=function(response,textStatus)
{
  var rows = "";
    for(var item in response.ProductDetails)
    {  
        if(Number.isInteger(parseInt(item)))
        {
        $('#OrdersSubtotal').html(response.singleOrderDetailsFromShopify.subtotal_price.toFixed(2));
        $('#OrdersTax').html(response.singleOrderDetailsFromShopify.total_tax);
        $('#OrderTotal').html(response.singleOrderDetailsFromShopify.total_price.toFixed(2));
        $('#OrdersShipping').html(response.singleOrderDetailsFromShopify.total_shipping_price_set.shop_money.amount);
      var shipDate = response.ProductDetails[item].ship_date == undefined || response.ProductDetails[item].ship_date == null ? "" : response.ProductDetails[item].ship_date;
      var trackingNo = response.ProductDetails[item].trackingNumber == undefined || response.ProductDetails[item].trackingNumber == null ? "" : response.ProductDetails[item].trackingNumber;
      var discountedPrice = response.ProductDetails[item].discountedPrice == undefined || response.ProductDetails[item].discountedPrice == null ? "0" : response.ProductDetails[item].discountedPrice;
      var refundedQuantity = response.ProductDetails[item].refundedQuantity == undefined || response.ProductDetails[item].refundedQuantity == null ? "0" : response.ProductDetails[item].refundedQuantity;
      var totalPrice = response.ProductDetails[item].discountedPrice == undefined || response.ProductDetails[item].discountedPrice == null || response.ProductDetails[item].discountedPrice == "0" ? response.ProductDetails[item].quantity * response.ProductDetails[item].ItemPrice : response.ProductDetails[item].quantity * response.ProductDetails[item].discountedPrice;
         rows += '<tr class = "class="Polaris-DataTable__TableRow"">'+
              '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><img  style="height: 75px;" src='+response.ProductDetails[item].Image+' height="100"></td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+response.ProductDetails[item].Title+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+response.ProductDetails[item].quantity+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+refundedQuantity+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+response.ProductDetails[item].ItemPrice+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+discountedPrice+'</td>'+
              '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+trackingNo+'</td>'+
              '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+shipDate+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+totalPrice.toFixed(2)+'</td></tr>';

        }
    }
    return rows; 
}

var showModelData = function(Id, flag = "orderId")
{
  $('#modalDialog').show();
  $('#PopuploadGif').show();
  document.getElementById( 'ViewProductModel' ).innerHTML = "";
  $('#OrdersSubtotal').html("");
  $('#OrdersTax').html("");
  $('#OrdersShipping').html("");
  $('#OrderTotal').html("");
  $('#orderNote').html("");
    if(flag=="clientId")
    {
         $("#popupTitle").html("CUSTOMER DETAILS");
     $('#orderAmountDetailsOnPopup').hide();
        urlVal=window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?customerId={{customer.id}}&customerName={{customer.first_name}}&clientId="+Id+"&data=25";
               $.get(
               urlVal,
               function (data, status) {
                      var rows = '<tr  class="Polaris-DataTable__TableRow">'+
                             '<th class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" scope="col" aria-disabled="true" align="left" width="100">Name</th>'+
                             '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric">'+data.SingleClientOrders.ClientName+'</td>'+
                             '</tr>'+
                          '<tr>'+
                             '<th class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" scope="col" aria-disabled="true" align="left">Email</th>'+
                             '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+data.SingleClientOrders.CustomerMailid+'</td>'+
                          '</tr>'+
                          '<tr>'+
                             '<th class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" scope="col" aria-disabled="true" align="left">Address</th>'+
                             '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(data.SingleClientOrders.address1 == null ? "" : data.SingleClientOrders.address1)+'</td>'+
                          '</tr>'+
                          '<tr>'+
                             "<th class='Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric' scope='col' aria-disabled='true' align='left'>Company Name</th>"+
                             '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(data.SingleClientOrders.companyName == null ? "" : data.SingleClientOrders.companyName) +'</td>'+
                          '</tr>'+
                          '<tr>'+
                             '<th class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" scope="col" aria-disabled="true" align="left">Customers Notes </th>'+
                             '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(data.SingleClientOrders.notes == null ? "" :data.SingleClientOrders.notes)+'</td>'+
                          '</tr>'+
                          '<tr>'+
                             '<th class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" scope="col" aria-disabled="true" align="left">Total Spent(Subtotal+Tax)</th>'+
                             '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+currencyFormat+data.SingleShopifyCustomers.shopifyTotalSpent +'</td>'+
                          '</tr>'+
                          '<tr>'+
                             '<th class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" scope="col" aria-disabled="true" align="left">Number of Orders</th>'+
                             '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+data.SingleClientOrders.shopifyOrdersCount +'</td>'+
                          '</tr>'+
                          '<tr>'+
                             '<th class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" scope="col" aria-disabled="true" align="left">Tags</th>'+
                             '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+(data.SingleClientOrders.tags == null ? "" :data.SingleClientOrders.tags) +'</td>'+
                          '</tr>';
               $('#ViewProductModel').html(rows);
               $('#PopuploadGif').hide();
           }
         );          
    }
    else if(flag == "draftId")
    {
       $("#popupTitle").html("Draft Order Details");
      var urlVal = window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?customerId={{customer.id}}&customerName={{customer.first_name }}&orderId="+Id+"&data=20";
      $.get(
        urlVal,
        function (response, status) {  
          var rows = '<tr>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;"></th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product Name</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Size</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Quantity</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Price</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Status</th>'+
              '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Subtotal</th></tr>';
          for(var item in response.ProductDetails)
          { 
            if(Number.isInteger(parseInt(item)))
            {
              var subTotalPrice=response.ProductDetails[item].quantity*response.ProductDetails[item].ItemPrice;
              rows += '<tr class="Polaris-DataTable__TableRow">'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><img src='+response.ProductDetails[item].Image+' height="100"></td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><span>'+response.ProductDetails[item].Title+'</span></td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><span>'+response.ProductDetails[item].size+'</span></td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;text-transform: capitalize;">'+response.ProductDetails[item].quantity+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">$ '+parseFloat(response.ProductDetails[item].ItemPrice).toFixed(2)+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+response.ProductDetails[item].fulfillmentStatus+'</td>'+
                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">$ '+parseFloat(subTotalPrice).toFixed(2)+'</td></tr>';
            }
          }
          $('#ViewProductModel').html(rows);
          $('#PopuploadGif').hide();
          $('#orderAmountDetailsOnPopup').show();
          $('#OrdersSubtotal').html(response.draftOrder.subtotal_price);
          $('#OrdersTax').html(response.draftOrder.total_tax);
          $('#OrdersShipping').html(response.draftOrder.shipping_line.price);
          $('#OrderTotal').html(response.draftOrder.total_price);
          $('#orderNote').html(response.draftOrder.note);
          $('#OrdersSubtotal').html(response.draftOrder.subtotal_price.toFixed(2));
     });
    }
    else
    {
   $("#popupTitle").html("Product Details");
     var rows = '<tr>'+
        '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Product</th>'+
        '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Title</th>'+
        '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Quantity</th>'+
        '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Refunded Amount</th>'+
        '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Item Price</th>'+
        '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">discounted Price</th>'+
        '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Tracking Number</th>'+
        '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Ship Date</th>'+
        '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Total Price</th></tr>';
      
      if(flag == "orderNumber")
      {
        for(var item in ProductsArray)
        {                
          if(Number.isInteger(parseInt(item)) && ProductsArray[item].OrderNumber==Id)
          {
            isPresentInProductArray = true;
            $('#OrdersSubtotal').html(ProductsArray[item].subtotal);
            $('#OrdersTax').html(ProductsArray[item].tax);
            $('#OrdersShipping').html(ProductsArray[item].shipping);
            $('#OrderTotal').html(ProductsArray[item].total);
            $('#orderNote').html(ProductsArray[item].note);
            var discountedPrice = ProductsArray[item].discountedTotalPrice == undefined || ProductsArray[item].discountedTotalPrice == null || ProductsArray[item].discountedTotalPrice == "0.00" ? moneyformate +" 0.00" : moneyformate+" " + ProductsArray[item].discountedTotalPrice;
            var totalPrice = ProductsArray[item].discountedTotalPrice == undefined || ProductsArray[item].discountedTotalPrice == null || ProductsArray[item].discountedTotalPrice == "0.00" ? ProductsArray[item].quantity * ProductsArray[item].price : (ProductsArray[item].quantity * ProductsArray[item].price) - ProductsArray[item].discountedTotalPrice;
			var trackingNumber = ProductsArray[item].TrackingNumber == undefined || ProductsArray[item].TrackingNumber == null || ProductsArray[item].TrackingNumber == 0 ? "" : ProductsArray[item].TrackingNumber;
            rows += '<tr class = "class="Polaris-DataTable__TableRow"">'+
                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ProductsArray[item].image+'</td>'+
                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ProductsArray[item].title+'</td>'+
                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ProductsArray[item].quantity+'</td>'+
                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ moneyformate +' '+ProductsArray[item].totalRefundedAmount+'</td>'+
                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ moneyformate +' '+ ProductsArray[item].price+'</td>'+
                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+discountedPrice+'</td>'+
                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+trackingNumber+'</td>'+
                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ProductsArray[item].ShipDate+'</td>'+
                    '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+ moneyformate +' '+totalPrice.toFixed(2)+'</td></tr>';
          }
        }
     $('#ViewProductModel').html(rows);
        $('#orderAmountDetailsOnPopup').show();
        $('#PopuploadGif').hide();
        }    
        else
        {
          var urlVal = window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?customerId={{customer.id}}&customerName={{customer.first_name }}&orderId="+Id+"&data=19";
          $.get(
                urlVal,
                function (data, status) {  
                rows += onSuccessOrderProducts(data, status);
         $('#ViewProductModel').html(rows);
        $('#orderAmountDetailsOnPopup').show();
        $('#PopuploadGif').hide();
           });
        }
    }
          
    }
    var closeModal = function()
{
  $('#modalDialog').hide(); 
}

    var onSuccessSubmit = function (response,textStatus)
    {
      if(response == false)
      {
        $("#errorsmsg").show();
        $("#successmsg").hide();
      }
      else
      {
        $("#successmsg").show();
        $("#errorsmsg").hide();
      }
    $("#addsalesrep").html("Add SalesRep");
    }
  
  var AddSalesRep = function(){
    var url_string = window.location.href;
    var url = new URL(url_string);
    var ManagerId = url.searchParams.get("manager");

    if (!ManagerId) {
        ManagerId = url.searchParams.get("MANAGER");
    }
    
    if(document.getElementById("sr_salesrep_email").value==""){
        $('#emailerror').show();
      }     
      else if(document.getElementById("sr_salesrep_firstname").value==""){
        $('#fnameerror').show();
      }
      
      else{
        $("#addsalesrep").html("Adding SalesRep...");        
    $("#errorsmsg").hide();
    $("#successmsg").hide();
        
        var email = document.getElementById("sr_salesrep_email").value;
        var fname = document.getElementById("sr_salesrep_firstname").value;
        var lname = document.getElementById("sr_salesrep_lastname").value;
        
        var SalesRepId;
    {% if customer %}
      SalesRepId = {{customer.id}};
    {% else %}
      SalesRepId = "";
    {% endif %}
        
         var TeamManagerName="{{customer.first_name}} {{customer.last_name}}"
      
      var user = {
        "salesrepId" : SalesRepId,
          "email" : email,
            "name" : fname,
            "TeamManagerName": TeamManagerName,
            "Lname": lname,
          "IsTeamManager":true,
      }
        console.log(user);
        var data = JSON.stringify(user);
        var urlVal = window.location.protocol +"//"+ window.location.hostname +"/apps/SalesRep?pageIndex=21&data="+data;
        console.log(urlVal);
        $.post(
          urlVal,
        function (data, status) {                 
             onSuccessSubmit(data, status);                            
          }
      );
      }
  }

  var ShowSharedCartProducts=function(productarray,filter)
    {
        if(filter)
        {
            var orderRow = '<tr>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;"> </th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">Image</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">[ShowSharedCartProducts_column3]</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">[ShowSharedCartProducts_column4]</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">[ShowSharedCartProducts_column5]</th>'+
            '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric" scope="col" style="height: 54px;">[ShowSharedCartProducts_column6]</th></tr>';
      
                        for(var product in productarray)
                        {
                            for(var variant=0;productarray[product].variants.length>variant;variant++)
                            {
                            var productprice =productarray[product].variants[variant].price/100;
                                orderRow += '<tr class="Polaris-DataTable__TableRow">'+
                                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+
                                '<img class="sr_productImage" src="{{ 'plusIcon.png' | asset_url }}" style="cursor: pointer;" onclick="AddProductToSharedCart(\''+productarray[product].title+'\',\''+productprice+'\',\''+productarray[product].images+'\',\''+productarray[product].type+'\',\''+productarray[product].variants[variant].id+'\',\''+productarray[product].variants[variant].option1+'\',\''+productarray[product].variants[variant].available+'\')"></td>'+                 
                                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><img class="sr_productImage" style="width:60px;" src="'+productarray[product].images+'"></td>'+
                                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><input type="text" style="width:90px;" id="quantity_'+productarray[product].variants[variant].id+'" placeholder="Quantity"></td>'+
                                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productarray[product].title+'</td>'+
                                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productarray[product].variants[variant].option1+'</td>'+     
                                '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;">'+productprice+  " " +currency+'</td></tr>';                                                  
                                 
                            }
                        }
                                                                                                                                                    
                        document.getElementById('Carttable').innerHTML = orderRow; 
                        $('#SharedCarttable').show();
                        $("#SharedCartSpinner").hide(); 
            }
        else 
        {
            $('#SharedCarttable').hide();     
        }                                        
   } 

    var showAllSharedCart = function(data)
    {
        if(data.select.CartSharing)
              {
               var row = '<tr>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Cart Name</th>'+
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Sharable Cart Link</th>' +
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Copy Cart Link</th>' +
                '<th data-polaris-header-cell="true" class="Polaris-DataTable__Cell Polaris-DataTable__Cell--header Polaris-DataTable__Cell--numeric number" scope="col" style="height: 54px;">Delete Cart Link</th>';
              for(var i = 0; i < data.SharedCartDetails.length; i++)
              {
                row += '<tr id="row" class = "class="Polaris-DataTable__TableRow"">'+             
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;">'+(data.SharedCartDetails[i].CartName)+'</td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric commission" style="height: 72px;"><a href="' + (data.SharedCartDetails[i].CartUrl.toLowerCase()) + '"; target="_blank"; id="sharedcartlink' + i + '" style="color:blue;text-transform: lowercase !important;" >' + (data.SharedCartDetails[i].CartUrl.toLowerCase()) + '</a></td>' +
                  '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><div><div class="Polaris-ButtonGroup__Item"><button type="button" id="copysharedcart' + i + '" class="Polaris-Button Polaris-Button--primary" style="font-size:18px;padding-left: 35px;padding-right: 35px;" onclick="CopySharedCartLink(\''+ i + '\')"><span class="Polaris-Button__Content"><span>Copy Cart Link</span></span></button></div></div></td>'+
                     '<td class="Polaris-DataTable__Cell Polaris-DataTable__Cell--numeric" style="height: 72px;"><div><div class="Polaris-ButtonGroup__Item"><button type="button" id="deletesharedcart' + i + '" class="Polaris-Button Polaris-Button--primary" style="font-size:18px;padding-left: 35px;padding-right: 35px;" onclick="DeleteSharedCartLink(\'' + data.SharedCartDetails[i].CartUniqueId + '\',\'' + data.SharedCartDetails[i].ShopName + '\',\'' + i + '\')"><span class="Polaris-Button__Content"><span>Delete Cart Link</span></span></button></div></div></td>';
              }
                document.getElementById('existingSharedCartDetails').innerHTML = row;
      }
    }
      
function CopySharedCartLink(idNum) {
  let element = document.getElementById("sharedcartlink"+idNum); //select the element
  let elementText = element.textContent; //get the text content from the element
  navigator.clipboard.writeText(elementText);
  $('#copysharedcart' + idNum).text('Copied!!');
  setTimeout(function () { $('#copysharedcart' + idNum).text('Copy Cart Link');  }, 3000);
}
</script>
<script>
function openTab(evt, tabName) {
  if(tabName == "YourPreviousOrders")
  {
    ViewInvoiceOrders();
  }
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
}
</script>
<script>
  var mybutton = document.getElementById("scrollToTop");

// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}

// When the user clicks on the button, scroll to the top of the document
function scrollToTopFunction() {
  
    document.getElementById('ProductSearchInput').scrollIntoView();
    $(".ToTop").addClass("hide");
}

</script>